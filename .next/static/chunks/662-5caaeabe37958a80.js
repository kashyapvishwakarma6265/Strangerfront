"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{4662:function(e,o,r){r.r(o),r.d(o,{AuthProvider:function(){return w},useAuth:function(){return m}});var t=r(7437),a=r(2265),s=r(3085),l=r(994),n=r(4086),i={apiKey:"AIzaSyBoP9F82lZNJ_bIkkAWAhJwuOgYlS4JaFg",authDomain:"stranger-chat-74b46.firebaseapp.com",projectId:"stranger-chat-74b46",storageBucket:"stranger-chat-74b46.appspot.com",messagingSenderId:"75423958257",appId:"1:75423958257:web:c266a6120883cdaf69d550",measurementId:"G-00ZL9X1NHH"};console.log("\uD83D\uDD25 Firebase Config Check:"),console.log("  ✅ apiKey:",i.apiKey?"✅ SET":"❌ MISSING"),console.log("  ✅ authDomain:",i.authDomain?"✅ SET":"❌ MISSING"),console.log("  ✅ projectId:",i.projectId?"✅ SET":"❌ MISSING"),console.log("  ✅ storageBucket:",i.storageBucket?"✅ SET":"❌ MISSING"),console.log("  ✅ messagingSenderId:",i.messagingSenderId?"✅ SET":"❌ MISSING"),console.log("  ✅ appId:",i.appId?"✅ SET":"❌ MISSING"),i.apiKey&&i.authDomain&&i.projectId&&i.appId||console.error("❌ Firebase config incomplete! Check environment variables.");let u=null,c=null,d=null;try{console.log("\uD83D\uDE80 Initializing Firebase..."),u=(0,l.ZF)(i),console.log("✅ Firebase app initialized"),c=(0,s.v0)(u),console.log("✅ Firebase Auth initialized"),d=(0,n.ad)(u),console.log("✅ Firebase Firestore initialized"),(0,s.Fb)(c,s.a$).then(()=>{console.log("✅ Firebase persistence enabled - users stay logged in")}).catch(e=>{console.warn("⚠️ Persistence warning:",e.message)}),console.log("✅ Firebase fully initialized and ready to use!")}catch(e){console.error("❌ Firebase initialization error:",e.message),console.error("Error details:",e)}let g=()=>(d||console.warn("⚠️ Firestore not initialized"),d),p=async(e,o)=>{try{if(!e){console.warn("⚠️ No userId provided");return}let r=g();if(!r){console.warn("⚠️ Firestore not initialized");return}let t=(0,n.JU)(r,"users",e);(await (0,n.QT)(t)).exists()?(await (0,n.r7)(t,{...o,updatedAt:new Date().toISOString()}),console.log("✅ Profile updated")):(await (0,n.pl)(t,{...o,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),console.log("✅ Profile created"))}catch(e){throw console.error("❌ Profile operation error:",(null==e?void 0:e.message)||"Unknown error"),e}},h=(0,a.createContext)(),m=()=>{let e=(0,a.useContext)(h);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},w=e=>{let{children:o}=e,[r,l]=(0,a.useState)(null),[n,i]=(0,a.useState)(!0),[u,d]=(0,a.useState)(null);(0,a.useEffect)(()=>{console.log("\uD83D\uDD0D Setting up auth state listener...");let e=!0,o=(0,s.Aj)(c,async o=>{console.log("\uD83D\uDC64 onAuthStateChanged fired:",(null==o?void 0:o.email)||"null");try{o?(console.log("✅ User found:",o.email),p(o.uid,{uid:o.uid,email:o.email,displayName:o.displayName||o.email.split("@")[0],photoURL:o.photoURL,lastActive:new Date,status:"online"}).catch(e=>console.error("Profile update error:",e)),e&&(console.log("✅ Setting user state:",o.email),l(o),d(null),i(!1))):(console.log("❌ No user found"),e&&(l(null),i(!1)))}catch(o){console.error("❌ Auth state error:",o),e&&(d(o.message),i(!1))}},o=>{console.error("❌ Auth listener error:",o),e&&(d(o.message),i(!1))});return()=>{console.log("\uD83E\uDDF9 Cleaning up auth listener"),e=!1,o()}},[]);let g=async function(e,o){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{i(!0),d(null),console.log("\uD83D\uDCDD Starting signup for:",e);let t=await (0,s.Xb)(c,e,o);return console.log("✅ User created in Firebase:",t.user.email),r&&(await (0,s.ck)(t.user,{displayName:r}),console.log("✅ Display name updated")),await p(t.user.uid,{uid:t.user.uid,email:t.user.email,displayName:r||e.split("@")[0],createdAt:new Date,lastActive:new Date,status:"online"}),console.log("✅ User profile created"),t}catch(e){throw console.error("❌ Signup error:",e),d("auth/email-already-in-use"===e.code?"This email is already registered":"auth/weak-password"===e.code?"Password should be at least 6 characters":e.message),i(!1),e}},m=async(e,o)=>{try{d(null),console.log("\uD83D\uDD10 Starting login for:",e);let r=await (0,s.e5)(c,e,o);return console.log("✅ User logged in:",r.user.email),p(r.user.uid,{lastActive:new Date,status:"online"}).catch(e=>console.error("Profile update error:",e)),r}catch(e){throw console.error("❌ Login error:",e),d("auth/invalid-credential"===e.code?"Invalid email or password":"auth/user-not-found"===e.code?"User not found":e.message),i(!1),e}},w=async()=>{try{d(null),i(!0);let e=new s.hJ;e.addScope("profile"),e.addScope("email"),e.setCustomParameters({prompt:"consent"}),console.log("\uD83D\uDD37 Starting Google login with popup...");let o=await (0,s.rh)(c,e);console.log("✅ Google login successful:",o.user.email),await p(o.user.uid,{uid:o.user.uid,email:o.user.email,displayName:o.user.displayName,photoURL:o.user.photoURL,provider:"google",lastActive:new Date,status:"online"}),console.log("✅ Google user profile created")}catch(e){console.error("❌ Google login error:",e.code,e.message),"auth/popup-blocked-by-browser"===e.code?d("❌ Google popup was blocked. Allow popups in browser settings."):"auth/popup-closed-by-user"===e.code?d("You closed the Google popup. Try again."):"auth/cancelled-popup-request"===e.code?d("Sign in was cancelled. Try again."):"auth/operation-not-supported-in-this-environment"===e.code?d("❌ Google sign in not available. Check Firebase config."):d(e.message||"Failed to sign in with Google"),i(!1)}},D=async e=>{try{return d(null),await (0,s.LS)(c,e),console.log("✅ Password reset email sent"),!0}catch(e){throw console.error("❌ Reset password error:",e),d("auth/user-not-found"===e.code?"No account found with this email":e.message),e}},S=async()=>{try{i(!0),d(null),console.log("\uD83D\uDEAA Logging out..."),r&&await p(r.uid,{status:"offline"}),await (0,s.w7)(c),i(!1),console.log("✅ Logout successful")}catch(e){console.error("❌ Logout error:",e),d(e.message),i(!1)}};return(0,t.jsx)(h.Provider,{value:{user:r,signup:g,login:m,googleLogin:w,resetPassword:D,logout:S,loading:n,error:u,setError:d},children:o})}}}]);