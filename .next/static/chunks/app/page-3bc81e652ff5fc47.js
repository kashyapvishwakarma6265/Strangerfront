(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9676:function(e,t,a){Promise.resolve().then(a.bind(a,9728))},9728:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return D}});var s=a(7437),r=a(2265),n=a(4662);function l(e){let{onToggleMode:t}=e,[a,l]=(0,r.useState)(""),[i,o]=(0,r.useState)(""),[d,u]=(0,r.useState)(""),[c,m]=(0,r.useState)(!1),[x,g]=(0,r.useState)(!1),[h,p]=(0,r.useState)(""),[b,f]=(0,r.useState)(!1),[y,w]=(0,r.useState)(!1),{login:v,googleLogin:j,resetPassword:N,error:D}=(0,n.useAuth)(),S=async e=>{e.preventDefault(),u(""),m(!0);try{await v(a,i)}catch(e){u(e.message||"Login failed"),m(!1)}},C=async()=>{u(""),m(!0);try{await j()}catch(e){m(!1)}},k=async e=>{e.preventDefault(),u(""),f(!0);try{await N(h),w(!0),setTimeout(()=>{g(!1),p(""),w(!1)},3e3)}catch(e){u(e.message)}finally{f(!1)}};return x?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideUp",children:[(0,s.jsx)("h2",{className:"text-3xl font-bold text-gray-900 text-center mb-2",children:"\uD83D\uDD11 Reset Password"}),(0,s.jsx)("p",{className:"text-gray-600 text-center text-sm mb-6",children:"Enter your email to receive reset link"}),y&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-green-100 border-l-4 border-green-500 text-green-700 text-sm rounded animate-slideDown",children:"✅ Password reset email sent! Check your inbox."}),(d||D)&&!y&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 text-sm rounded animate-slideDown",children:d||D}),(0,s.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[(0,s.jsx)("input",{type:"email",placeholder:"Enter your email",value:h,onChange:e=>p(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,s.jsx)("button",{type:"submit",disabled:b,className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:shadow-lg transition disabled:opacity-60",children:b?"⏳ Sending...":"\uD83D\uDCE7 Send Reset Email"})]}),(0,s.jsx)("button",{onClick:()=>g(!1),className:"mt-4 w-full text-center text-blue-600 font-semibold hover:text-blue-700 transition",children:"← Back to Login"})]})}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideUp",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"\uD83D\uDD37 Welcome Back"}),(0,s.jsx)("p",{className:"text-gray-600 text-sm",children:"Login to your account"})]}),(d||D)&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 text-sm rounded animate-slideDown",children:d||D}),(0,s.jsxs)("form",{onSubmit:S,className:"space-y-4 mb-6",children:[(0,s.jsx)("input",{type:"email",placeholder:"Email",value:a,onChange:e=>l(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,s.jsx)("input",{type:"password",placeholder:"Password",value:i,onChange:e=>o(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,s.jsx)("button",{type:"submit",disabled:c,className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:shadow-lg transition disabled:opacity-60",children:c?"⏳ Logging in...":"\uD83D\uDD10 Login"})]}),(0,s.jsx)("button",{onClick:()=>g(!0),className:"block w-full text-center text-blue-600 font-semibold mb-6 hover:text-blue-700 transition",children:"\uD83D\uDD11 Forgot Password?"}),(0,s.jsxs)("div",{className:"relative mb-6",children:[(0,s.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,s.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,s.jsx)("div",{className:"relative flex justify-center",children:(0,s.jsx)("span",{className:"px-2 bg-white text-gray-600 text-sm",children:"OR"})})]}),(0,s.jsx)("button",{onClick:C,disabled:c,className:"w-full py-3 bg-white border-2 border-gray-300 text-gray-900 font-semibold rounded-lg hover:bg-gray-50 transition disabled:opacity-60 mb-6",children:"\uD83D\uDD37 Continue with Google"}),(0,s.jsxs)("p",{className:"text-center text-gray-600 text-sm",children:["Don't have an account?"," ",(0,s.jsx)("button",{onClick:t,className:"text-blue-600 font-semibold hover:text-blue-700 transition",children:"Sign up here"})]})]})})}function i(e){let{onToggleMode:t}=e,[a,l]=(0,r.useState)(""),[i,o]=(0,r.useState)(""),[d,u]=(0,r.useState)(""),[c,m]=(0,r.useState)(""),[x,g]=(0,r.useState)(""),[h,p]=(0,r.useState)(!1),[b,f]=(0,r.useState)(!1),{signup:y,error:w}=(0,n.useAuth)(),v=async e=>{if(e.preventDefault(),g(""),!b){g("Please agree to the terms and conditions");return}if(i!==d){g("Passwords do not match");return}if(i.length<6){g("Password must be at least 6 characters");return}if(c.length<2){g("Display name must be at least 2 characters");return}p(!0);try{await y(a,i,c)}catch(e){g(e.message),p(!1)}};return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideUp",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"\uD83C\uDF89 Create Account"}),(0,s.jsx)("p",{className:"text-gray-600 text-sm",children:"Join our community"})]}),(x||w)&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 text-sm rounded animate-slideDown",children:x||w}),(0,s.jsxs)("form",{onSubmit:v,className:"space-y-4 mb-6",children:[(0,s.jsx)("input",{type:"text",placeholder:"Display Name",value:c,onChange:e=>m(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,s.jsx)("input",{type:"email",placeholder:"Email",value:a,onChange:e=>l(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,s.jsx)("input",{type:"password",placeholder:"Password (min. 6 characters)",value:i,onChange:e=>o(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,s.jsx)("input",{type:"password",placeholder:"Confirm Password",value:d,onChange:e=>u(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("input",{type:"checkbox",id:"terms",checked:b,onChange:e=>f(e.target.checked),className:"mt-1 w-4 h-4 cursor-pointer accent-blue-600"}),(0,s.jsx)("label",{htmlFor:"terms",className:"text-sm text-gray-700 cursor-pointer",children:"I agree to Terms & Conditions"})]}),(0,s.jsx)("button",{type:"submit",disabled:h,className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:shadow-lg transition disabled:opacity-60",children:h?"⏳ Creating Account...":"✨ Sign Up"})]}),(0,s.jsxs)("p",{className:"text-center text-gray-600 text-sm",children:["Already have an account?"," ",(0,s.jsx)("button",{onClick:t,className:"text-blue-600 font-semibold hover:text-blue-700 transition",children:"Login here"})]})]})})}var o=a(5732);let d=null,u=()=>{if(d)return d;let e="https://strangerback.onrender.com";return e?d=(0,o.io)(e,{}):(console.error("❌ NEXT_PUBLIC_SOCKET_URL is not set. Please check your .env.local file!"),null)};function c(e){var t;let{status:a,user:r,onLogout:n,isConnected:l,onNext:i,disabled:o=!1}=e;return(0,s.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-500 text-white px-3 md:px-6 py-2.5 md:py-4 shadow-lg flex flex-col md:flex-row justify-between items-start md:items-center gap-3 md:gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 md:gap-3 min-w-0 flex-1 w-full md:w-auto",children:[(0,s.jsx)("div",{className:"w-10 h-10 md:w-10 md:h-10 bg-white bg-opacity-30 rounded-full flex items-center justify-center text-base md:text-xl flex-shrink-0",children:"\uD83D\uDCAC"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("h1",{className:"text-base md:text-3xl font-bold truncate",children:"Blink Chat"}),(0,s.jsx)("p",{className:"text-xs md:text-sm opacity-90 truncate ",children:a})]})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-end sm:items-center gap-2 w-full sm:w-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 w-full sm:w-auto justify-between sm:justify-end",children:[(0,s.jsx)("span",{className:"text-xl md:text-xl font-semibold truncate max-w-[400px] sm:max-w-xs text-right",children:(null==r?void 0:r.displayName)||(null==r?void 0:null===(t=r.email)||void 0===t?void 0:t.split("@")[0])||"Guest"}),(0,s.jsx)("button",{onClick:n,className:"px-2.5 md:px-4 py-1.5 md:py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition text-xs md:text-base font-semibold whitespace-nowrap",children:"Logout"})]}),(0,s.jsx)("button",{type:"button",onClick:()=>{o||"function"!=typeof i||i()},disabled:o,className:"bg-white bg-opacity-20 hover:bg-opacity-30 disabled:bg-grey bg-opacity-20 disabled:cursor-not-allowed text-white rounded-full px-4 py-2 transition flex items-center gap-1.5 text-sm font-medium w-full sm:w-auto justify-center",title:"Next Stranger",children:"Next Stranger"})]})]})}let m=["\uD83D\uDE00","\uD83D\uDE03","\uD83D\uDE04","\uD83D\uDE01","\uD83D\uDE06","\uD83D\uDE05","\uD83E\uDD23","\uD83D\uDE02","\uD83D\uDE42","\uD83D\uDE0D","\uD83D\uDC4D","\uD83D\uDC4F","❤️","\uD83C\uDF89","\uD83D\uDD25","✨"];function x(e){let{isOpen:t,onEmojiSelect:a,onClose:r}=e;return t?(0,s.jsxs)("div",{className:"absolute bottom-full left-0 z-50 bg-white border rounded-xl shadow p-2 w-72",children:[(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:m.map(e=>(0,s.jsx)("button",{className:"text-2xl p-2",onClick:()=>a(e),children:e},e))}),(0,s.jsx)("button",{className:"mt-2 text-sm text-gray-500",onClick:r,children:"Close"})]}):null}function g(e){let{value:t,onChange:a,onSubmit:n,disabled:l,onImageSelect:i,onVideoSelect:o,onVoiceRecord:d,sendingMedia:u,uploadProgress:c}=e,m=(0,r.useRef)(null),g=(0,r.useRef)(null),[h,p]=(0,r.useState)(!1),[b,f]=(0,r.useState)(!1),[y,w]=(0,r.useState)(!1),v=(0,r.useRef)(null),j=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e),a=[],s=performance.now();t.ondataavailable=e=>a.push(e.data),t.onstop=()=>{let t=new Blob(a,{type:"audio/webm"}),r=Math.round((performance.now()-s)/1e3);d({blob:t,duration:r}),p(!1),e.getTracks().forEach(e=>e.stop())},p(!0),t.start(),s=performance.now(),setTimeout(()=>{"inactive"!==t.state&&t.stop()},6e4)}catch(e){alert("Microphone access denied or unavailable.")}},N=e=>{e.target.style.height="auto",e.target.style.height="".concat(e.target.scrollHeight,"px"),a(e)};return(0,s.jsxs)("form",{className:"w-full bg-white border-t border-gray-200 flex flex-col gap-1 px-2 py-2 sm:gap-2 sm:px-4 sm:py-3 sticky bottom-0",style:{boxShadow:"0 -1px 8px rgba(60,60,60,0.05)"},onSubmit:e=>{e.preventDefault(),n(e),v.current&&(v.current.style.height="40px")},autoComplete:"off",children:[b&&(0,s.jsx)("div",{className:"absolute bottom-16 left-4 z-20",children:(0,s.jsx)(x,{isOpen:!0,onEmojiSelect:e=>{a({target:{value:t+e}}),f(!1),setTimeout(()=>{v.current&&(v.current.style.height="auto",v.current.style.height="".concat(v.current.scrollHeight,"px"))},0)},onClose:()=>f(!1)})}),(0,s.jsxs)("div",{className:"flex items-end gap-2 relative",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{var e;null===(e=m.current)||void 0===e||e.click(),w(!1)},className:"bg-blue-500 hover:bg-blue-600 rounded-full text-white p-3 transition flex items-center justify-center",children:"\uD83D\uDCF7"}),(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)("textarea",{ref:v,value:t,onChange:N,onInput:N,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||e.ctrlKey||(e.preventDefault(),t.trim()&&!l&&null==u&&n(e))},placeholder:"Message...",rows:1,disabled:l||null!=u,className:"w-full bg-gray-300 rounded-full resize-none px-4 py-2 pr-10 text-base border-none outline-none focus:ring-0",style:{minHeight:40,maxHeight:100}}),(0,s.jsx)("button",{type:"button",onClick:()=>w(!y),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 rounded-full hover:bg-gray-200 transition",title:"Attach",children:"\uD83D\uDCCE"}),y&&(0,s.jsxs)("div",{className:"absolute bottom-12 right-0 bg-white border border-gray-200 shadow-lg rounded-lg p-2 flex flex-col z-10 w-40",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{var e;null===(e=g.current)||void 0===e||e.click(),w(!1)},className:"flex items-center gap-2 px-3 py-2 hover:bg-gray-100 rounded text-left text-sm",children:"\uD83C\uDFA5 Video"}),(0,s.jsx)("button",{type:"button",onClick:()=>{f(!0),w(!1)},className:"flex items-center gap-2 px-3 py-2 hover:bg-gray-100 rounded text-left text-sm",children:"\uD83D\uDE42 Emoji"})]})]}),t.trim()?(0,s.jsx)("button",{type:"submit",disabled:l||!t.trim()||null!=u,className:"bg-blue-500 hover:bg-blue-600 rounded-full text-white p-3 transition flex items-center justify-center",title:"Send",children:"➢"}):(0,s.jsx)("button",{type:"button",onClick:h?()=>p(!1):j,className:"".concat(h?"bg-red-600 hover:bg-red-700 animate-pulse":"bg-purple-500 hover:bg-purple-600"," rounded-full text-white p-3 transition flex items-center justify-center"),disabled:null!=u||l,title:h?"Stop Recording":"Record Voice",children:h?"⏹️":"\uD83C\uDFA4"})]}),(0,s.jsx)("input",{ref:m,type:"file",accept:"image/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;if(!a.type.startsWith("image/")||a.size>10485760){alert("Please select an image under 10MB.");return}let s=new FileReader;s.onload=()=>i({base64:s.result,name:a.name}),s.onerror=()=>alert("Couldn't load image."),s.readAsDataURL(a),e.target.value=""},className:"hidden"}),(0,s.jsx)("input",{ref:g,type:"file",accept:"video/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;if(!a.type.startsWith("video/")||a.size>20971520){alert("Please select a video under 20MB.");return}let s=new FileReader;s.onload=()=>{let e=document.createElement("video");e.src=s.result,e.onloadedmetadata=()=>{let t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0),o({base64:s.result,thumbnail:t.toDataURL("image/jpeg",.7),duration:Math.round(e.duration),name:a.name})},e.onerror=()=>alert("Couldn't load video.")},s.readAsDataURL(a),e.target.value=""},className:"hidden"}),u&&c>0&&(0,s.jsx)("div",{className:"absolute left-0 bottom-0 w-full h-1 bg-gray-200 overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:"".concat(c,"%")}})})]})}function h(e){var t,a,r;let{message:n,senderType:l}=e,i="you"===l,o=null!==(t=n.isSent)&&void 0!==t&&t,d=null!==(a=n.isDelivered)&&void 0!==a&&a,u=null!==(r=n.isSeen)&&void 0!==r&&r;return(0,s.jsx)("div",{className:"flex mb-3 px-3 ".concat(i?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"relative p-3 sm:p-4 max-w-[100%] sm:max-w-[90%] rounded-3xl shadow-md transition-all\n        ".concat(i?"bg-gradient-to-r from-pink-500/90 to-[#ff3e9e]/90 text-white rounded-br-md shadow-sm":"bg-[#2c2c2e]/90 text-gray-100 rounded-bl-md backdrop-blur-sm shadow-sm border border-white/10"),children:[(0,s.jsx)("div",{className:"text-[11px] sm:text-xs font-medium mb-1\n          ".concat(i?"text-pink-100 text-right":"text-gray-400 text-left"),children:i?n.userName||"You":n.userName||"Anon"}),"text"===n.type&&(0,s.jsx)("p",{className:"text-sm sm:text-base leading-snug break-words whitespace-pre-line",children:n.text}),"image"===n.type&&(0,s.jsx)("div",{className:"overflow-hidden rounded-2xl my-1",children:(0,s.jsx)("img",{src:n.mediaUrl,alt:"media",className:"rounded-2xl w-full max-h-72 object-cover hover:opacity-90 transition"})}),"video"===n.type&&(0,s.jsx)("video",{controls:!0,className:"rounded-2xl w-full my-1 max-h-72 object-cover",children:(0,s.jsx)("source",{src:n.mediaUrl})}),"voice"===n.type&&(0,s.jsx)("audio",{controls:!0,className:"w-[250px] mt-1 accent-[#ff3e9e]",children:(0,s.jsx)("source",{src:n.mediaUrl})}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-1 mt-1",children:[(0,s.jsx)("div",{className:"text-[10px] sm:text-xs ".concat(i?"text-pink-100":"text-gray-400"),children:n.timestamp&&new Date(n.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),i&&(0,s.jsx)("div",{className:"text-[11px] sm:text-xs",children:u?(0,s.jsx)("span",{className:"text-yellow-800 font-bold",children:"✓✓"}):d?(0,s.jsx)("span",{className:"text-blue-400 font-bold",children:"✓✓"}):o?(0,s.jsx)("span",{className:"text-gray-500 font-bold",children:"✓"}):(0,s.jsx)("span",{children:"\xa0"})})]})]})})}function p(e){let{strangerName:t}=e;return(0,s.jsx)("div",{className:"flex gap-2 mb-2 animate-slideIn",children:(0,s.jsxs)("div",{className:"flex items-center gap-1 px-4 py-2 bg-gray-200 text-gray-900 rounded-2xl rounded-bl-none shadow-md",children:[(0,s.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,s.jsx)("span",{className:"w-2 h-2 bg-gray-600 rounded-full animate-bounce"}),(0,s.jsx)("span",{className:"w-2 h-2 bg-gray-600 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,s.jsx)("span",{className:"w-2 h-2 bg-gray-600 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,s.jsxs)("span",{className:"text-xs font-semibold text-gray-600 ml-1",children:[t||"Stranger"," is typing",(0,s.jsx)("span",{className:"animate-pulse",children:"..."})]})]})})}var b=a(6691),f=a.n(b),y={src:"/_next/static/media/look.ace1784b.gif",height:512,width:512,blurWidth:0,blurHeight:0},w={src:"/_next/static/media/talk.7bcf03f0.gif",height:256,width:256,blurWidth:0,blurHeight:0},v={src:"/_next/static/media/left.38e7fdea.gif",height:400,width:400,blurWidth:0,blurHeight:0};function j(){let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(""),[i,o]=(0,r.useState)("Connecting..."),[d,m]=(0,r.useState)(!1),[x,b]=(0,r.useState)(!1),[j,N]=(0,r.useState)(null),[D,S]=(0,r.useState)("Stranger"),[C,k]=(0,r.useState)(null),[E,T]=(0,r.useState)(0),[I,R]=(0,r.useState)(new Map),[U,A]=(0,r.useState)(!1),[L,F]=(0,r.useState)(!1),M=(0,r.useRef)(null),P=(0,r.useRef)(null),{user:_,logout:V}=(0,n.useAuth)(),W=(0,r.useRef)(null),z=(0,r.useRef)(null),B=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(!_)return;M.current=u();let e=M.current;return e.emit("user info",{userId:_.uid,email:_.email,displayName:_.displayName||_.email.split("@")[0]}),e.on("connect",()=>{o("Connected"),m(!0),A(!1),F(!1),z.current&&clearTimeout(z.current)}),e.on("connect_error",()=>o("Warning: Connection error - retrying...")),e.on("disconnect",t=>{m(!1),o("Disconnected: "+t),"io server disconnect"===t&&(z.current=setTimeout(()=>e.connect(),2e3))}),e.on("waiting",e=>{o(e.message),m(!1),A(!0),S("Stranger"),F(!1)}),e.on("paired",e=>{N(e.roomId),o("Connected to a stranger"),m(!0),A(!1),t([]),S("Stranger"),F(!1)}),e.on("chat message",e=>{t(t=>[...t,{id:e.id||Date.now().toString(),text:e.message,type:e.type||"text",mediaUrl:e.mediaUrl,thumbnail:e.thumbnail,duration:e.duration,senderType:"stranger",userName:e.userName||"Stranger",timestamp:new Date,isSent:!0,isDelivered:!0,isSeen:!0}]),b(!1),setTimeout(()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})},50)}),e.on("message status",e=>{let{id:a,status:s}=e;t(e=>e.map(e=>e.id===a?{...e,isSent:"sent"===s||e.isSent,isDelivered:"delivered"===s||e.isDelivered,isSeen:"seen"===s||e.isSeen}:e))}),e.on("media upload ack",()=>{}),e.on("typing",e=>b(e.isTyping)),e.on("stranger left",e=>{o(e.message||"Stranger has left"),m(!1),N(null),b(!1),S("Stranger"),R(new Map),F(!0)}),()=>{z.current&&clearTimeout(z.current),B.current&&clearInterval(B.current),e.off()}},[_]),(0,r.useEffect)(()=>{M.current&&e.filter(e=>"stranger"===e.senderType&&!e.isSeen).forEach(e=>{M.current.emit("message seen",{id:e.id})})},[e]);let H=async e=>{if(d&&M.current&&j){k("voice"),T(5);try{let a=new FileReader;a.onload=()=>{let s=a.result;M.current.emit("chat message",{message:"Voice message",type:"voice",mediaUrl:s,duration:e.duration||0,roomId:j,userId:_.uid,userName:_.displayName||_.email}),t(e=>[...e,{id:Date.now().toString(),text:"Voice message",type:"voice",mediaUrl:s,senderType:"you",userName:_.displayName||_.email,timestamp:new Date}]),k(null),T(100)},a.readAsDataURL(e.blob)}catch(e){k(null),T(0)}}},q=async e=>{if(d&&M.current&&j){k("image"),T(5);try{M.current.emit("chat message",{message:"Image",type:"image",mediaUrl:e.base64,roomId:j,userId:_.uid,userName:_.displayName||_.email}),t(t=>[...t,{id:Date.now().toString(),text:"Image",type:"image",mediaUrl:e.base64,senderType:"you",userName:_.displayName||_.email,timestamp:new Date}]),k(null),T(100)}catch(e){k(null),T(0)}}},O=async e=>{if(d&&M.current&&j){k("video"),T(5);try{M.current.emit("chat message",{message:"Video",type:"video",mediaUrl:e.base64,thumbnail:e.thumbnail,duration:e.duration,roomId:j,userId:_.uid,userName:_.displayName||_.email}),t(t=>[...t,{id:Date.now().toString(),text:"Video",type:"video",mediaUrl:e.base64,thumbnail:e.thumbnail,duration:e.duration,senderType:"you",userName:_.displayName||_.email,timestamp:new Date}]),k(null),T(100)}catch(e){k(null),T(0)}}},K=()=>{M.current&&(t([]),N(null),b(!1),m(!1),A(!0),o("Looking for a new stranger..."),S("Stranger"),R(new Map),F(!1),M.current.emit("find next"))},G=async()=>{M.current&&M.current.disconnect(),await V()};return(0,s.jsxs)("div",{className:"flex flex-col h-screen bg-white",children:[(0,s.jsx)(c,{status:i,user:_,onLogout:G,isConnected:d,onNext:K,disabled:!d}),(0,s.jsxs)("main",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,s.jsxs)("section",{className:"flex-1 overflow-y-auto scrollbar-thin px-4 py-3 space-y-3 md:px-6 md:py-4",children:[0===e.length?(0,s.jsx)("div",{className:"flex flex-col items-center justify-center h-full text-center space-y-6 px-4",children:L?(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4 animate-fadeIn",children:[(0,s.jsx)(f(),{src:v,alt:"Stranger left",width:80,height:80,className:"object-contain drop-shadow-lg",unoptimized:!0,priority:!0}),(0,s.jsx)("p",{className:"text-2xl md:text-3xl font-bold text-red-600",children:"Stranger has left the chat"}),(0,s.jsx)("button",{onClick:K,className:"px-6 py-2.5 bg-blue-600 text-white rounded-full text-sm font-medium hover:bg-blue-700 transition shadow-md",children:"Find Someone New"})]}):d?(0,s.jsxs)("div",{className:"flex items-center space-x-3 animate-fadeIn",children:[(0,s.jsx)(f(),{src:w,alt:"Ready to chat",width:56,height:56,className:"object-contain drop-shadow-md",unoptimized:!0,priority:!0}),(0,s.jsxs)("p",{className:"text-xl md:text-2xl font-semibold text-green-600 flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,s.jsx)("span",{children:"Start a conversation..."})]})]}):(0,s.jsxs)("div",{className:"flex items-center space-x-3 animate-fadeIn",children:[(0,s.jsx)(f(),{src:y,alt:"Connecting...",width:56,height:56,className:"object-contain drop-shadow-md",unoptimized:!0,priority:!0}),(0,s.jsx)("p",{className:"text-lg md:text-xl font-medium text-gray-600",children:i})]})}):(0,s.jsxs)(s.Fragment,{children:[e.map(e=>(0,s.jsx)(h,{message:e,senderType:e.senderType},e.id)),x&&(0,s.jsx)(p,{strangerName:D})]}),(0,s.jsx)("div",{ref:P})]}),(0,s.jsx)(g,{value:a,onChange:e=>{l(e.target.value),d&&M.current&&j&&(M.current.emit("typing",{isTyping:!0,roomId:j}),W.current&&clearTimeout(W.current),W.current=setTimeout(()=>{M.current&&j&&M.current.emit("typing",{isTyping:!1,roomId:j})},1e3))},onSubmit:e=>{if(e.preventDefault(),!a.trim()||!d||!M.current||!j)return;let s=a.trim(),r="".concat(Date.now()).concat(Math.random().toString(36).slice(2));M.current.emit("chat message",{id:r,message:s,type:"text",roomId:j,userId:_.uid,userName:_.displayName||_.email}),t(e=>[...e,{id:r,text:s,type:"text",senderType:"you",userName:_.displayName||_.email,timestamp:new Date,isSent:!1,isDelivered:!1,isSeen:!1}]),l(""),setTimeout(()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})},50)},disabled:!d,onVoiceRecord:H,onImageSelect:q,onVideoSelect:O,onNext:K,sendingMedia:C,uploadProgress:E,isWaiting:U})]})]})}function N(){let[e,t]=(0,r.useState)(!0),{user:a,loading:o}=(0,n.useAuth)();return((0,r.useEffect)(()=>{console.log("\uD83C\uDFAF AuthWrapper state update:",{userEmail:null==a?void 0:a.email,loading:o,isLoginMode:e})},[a,o,e]),o)?(console.log("⏳ Still loading..."),(0,s.jsxs)("div",{className:"loading-container",children:[(0,s.jsx)("div",{className:"loading-spinner"}),(0,s.jsx)("p",{className:"text-2xl",children:"\uD83D\uDCAC Blink chat"}),(0,s.jsx)("p",{className:"mt-6 text-xl font-dancing-script text-white drop-shadow-md",children:"Safe and 100% secure"})]})):a?(console.log("✅ User logged in, showing chat page"),(0,s.jsx)(j,{})):(console.log("\uD83D\uDCDD No user, showing login form"),e?(0,s.jsx)(l,{onToggleMode:()=>t(!1)}):(0,s.jsx)(i,{onToggleMode:()=>t(!0)}))}function D(){return(0,s.jsx)(N,{})}}},function(e){e.O(0,[358,487,647,298,662,971,938,744],function(){return e(e.s=9676)}),_N_E=e.O()}]);