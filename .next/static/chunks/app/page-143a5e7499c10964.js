(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5725:function(e,t,r){Promise.resolve().then(r.bind(r,344))},344:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var a=r(7437),n=r(2265),s=r(4662);function o(e){let{onToggleMode:t}=e,[r,o]=(0,n.useState)(""),[l,i]=(0,n.useState)(""),[d,c]=(0,n.useState)(""),[u,m]=(0,n.useState)(!1),[g,x]=(0,n.useState)(!1),[p,b]=(0,n.useState)(""),[h,f]=(0,n.useState)(!1),[y,v]=(0,n.useState)(!1),{login:w,googleLogin:j,resetPassword:N,error:D}=(0,s.useAuth)(),C=async e=>{e.preventDefault(),c(""),m(!0);try{await w(r,l)}catch(e){c(e.message||"Login failed"),m(!1)}},S=async()=>{c(""),m(!0);try{await j()}catch(e){m(!1)}},k=async e=>{e.preventDefault(),c(""),f(!0);try{await N(p),v(!0),setTimeout(()=>{x(!1),b(""),v(!1)},3e3)}catch(e){c(e.message)}finally{f(!1)}};return g?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideUp",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900 text-center mb-2",children:"\uD83D\uDD11 Reset Password"}),(0,a.jsx)("p",{className:"text-gray-600 text-center text-sm mb-6",children:"Enter your email to receive reset link"}),y&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-green-100 border-l-4 border-green-500 text-green-700 text-sm rounded animate-slideDown",children:"✅ Password reset email sent! Check your inbox."}),(d||D)&&!y&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 text-sm rounded animate-slideDown",children:d||D}),(0,a.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[(0,a.jsx)("input",{type:"email",placeholder:"Enter your email",value:p,onChange:e=>b(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,a.jsx)("button",{type:"submit",disabled:h,className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:shadow-lg transition disabled:opacity-60",children:h?"⏳ Sending...":"\uD83D\uDCE7 Send Reset Email"})]}),(0,a.jsx)("button",{onClick:()=>x(!1),className:"mt-4 w-full text-center text-blue-600 font-semibold hover:text-blue-700 transition",children:"← Back to Login"})]})}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideUp",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"\uD83D\uDD37 Welcome Back"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"Login to your account"})]}),(d||D)&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 text-sm rounded animate-slideDown",children:d||D}),(0,a.jsxs)("form",{onSubmit:C,className:"space-y-4 mb-6",children:[(0,a.jsx)("input",{type:"email",placeholder:"Email",value:r,onChange:e=>o(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,a.jsx)("input",{type:"password",placeholder:"Password",value:l,onChange:e=>i(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,a.jsx)("button",{type:"submit",disabled:u,className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:shadow-lg transition disabled:opacity-60",children:u?"⏳ Logging in...":"\uD83D\uDD10 Login"})]}),(0,a.jsx)("button",{onClick:()=>x(!0),className:"block w-full text-center text-blue-600 font-semibold mb-6 hover:text-blue-700 transition",children:"\uD83D\uDD11 Forgot Password?"}),(0,a.jsxs)("div",{className:"relative mb-6",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,a.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,a.jsx)("div",{className:"relative flex justify-center",children:(0,a.jsx)("span",{className:"px-2 bg-white text-gray-600 text-sm",children:"OR"})})]}),(0,a.jsx)("button",{onClick:S,disabled:u,className:"w-full py-3 bg-white border-2 border-gray-300 text-gray-900 font-semibold rounded-lg hover:bg-gray-50 transition disabled:opacity-60 mb-6",children:"\uD83D\uDD37 Continue with Google"}),(0,a.jsxs)("p",{className:"text-center text-gray-600 text-sm",children:["Don't have an account?"," ",(0,a.jsx)("button",{onClick:t,className:"text-blue-600 font-semibold hover:text-blue-700 transition",children:"Sign up here"})]})]})})}function l(e){let{onToggleMode:t}=e,[r,o]=(0,n.useState)(""),[l,i]=(0,n.useState)(""),[d,c]=(0,n.useState)(""),[u,m]=(0,n.useState)(""),[g,x]=(0,n.useState)(""),[p,b]=(0,n.useState)(!1),[h,f]=(0,n.useState)(!1),{signup:y,error:v}=(0,s.useAuth)(),w=async e=>{if(e.preventDefault(),x(""),!h){x("Please agree to the terms and conditions");return}if(l!==d){x("Passwords do not match");return}if(l.length<6){x("Password must be at least 6 characters");return}if(u.length<2){x("Display name must be at least 2 characters");return}b(!0);try{await y(r,l,u)}catch(e){x(e.message),b(!1)}};return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideUp",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"\uD83C\uDF89 Create Account"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"Join our community"})]}),(g||v)&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 text-sm rounded animate-slideDown",children:g||v}),(0,a.jsxs)("form",{onSubmit:w,className:"space-y-4 mb-6",children:[(0,a.jsx)("input",{type:"text",placeholder:"Display Name",value:u,onChange:e=>m(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,a.jsx)("input",{type:"email",placeholder:"Email",value:r,onChange:e=>o(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,a.jsx)("input",{type:"password",placeholder:"Password (min. 6 characters)",value:l,onChange:e=>i(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,a.jsx)("input",{type:"password",placeholder:"Confirm Password",value:d,onChange:e=>c(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("input",{type:"checkbox",id:"terms",checked:h,onChange:e=>f(e.target.checked),className:"mt-1 w-4 h-4 cursor-pointer accent-blue-600"}),(0,a.jsx)("label",{htmlFor:"terms",className:"text-sm text-gray-700 cursor-pointer",children:"I agree to Terms & Conditions"})]}),(0,a.jsx)("button",{type:"submit",disabled:p,className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:shadow-lg transition disabled:opacity-60",children:p?"⏳ Creating Account...":"✨ Sign Up"})]}),(0,a.jsxs)("p",{className:"text-center text-gray-600 text-sm",children:["Already have an account?"," ",(0,a.jsx)("button",{onClick:t,className:"text-blue-600 font-semibold hover:text-blue-700 transition",children:"Login here"})]})]})})}var i=r(5732);let d=null,c=()=>(d||((d=(0,i.ZP)("http://localhost:3001",{reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:1/0,transports:["websocket","polling"],maxHttpBufferSize:104857600,timeout:12e4,upgrade:!0,rememberUpgrade:!0,autoConnect:!0})).on("reconnect",e=>{console.log("\uD83D\uDD04 Reconnected after ".concat(e," attempts"))}),d.on("reconnect_error",e=>{console.error("❌ Reconnect error:",e.message)}),d.on("reconnect_failed",()=>{console.error("❌ Reconnection failed")})),d);function u(e){var t;let{status:r,user:n,onLogout:s,isConnected:o}=e;return(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-500 text-white px-3 md:px-6 py-2.5 md:py-4 shadow-lg flex justify-between items-center gap-2 md:gap-4 flex-wrap md:flex-nowrap",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 md:gap-3 min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"w-7 h-7 md:w-10 md:h-10 bg-white bg-opacity-30 rounded-full flex items-center justify-center text-base md:text-xl flex-shrink-0",children:"\uD83D\uDCAC"}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("h1",{className:"text-base md:text-2xl font-bold truncate",children:"Blink Chat"}),(0,a.jsx)("p",{className:"text-xs md:text-sm opacity-90 truncate",children:r})]})]}),o&&(0,a.jsxs)("div",{className:"hidden sm:flex items-center gap-2 text-xs md:text-sm flex-shrink-0",children:[(0,a.jsx)("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),(0,a.jsx)("span",{children:"Connected"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5 md:gap-4 min-w-0 flex-shrink-0",children:[(0,a.jsx)("span",{className:"text-xs md:text-sm font-semibold text-right truncate max-w-xs",children:(null==n?void 0:n.displayName)||(null==n?void 0:null===(t=n.email)||void 0===t?void 0:t.split("@")[0])||"Guest"}),(0,a.jsx)("button",{onClick:s,className:"px-2.5 md:px-4 py-1.5 md:py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition text-xs md:text-base font-semibold flex-shrink-0",children:"Logout"})]})]})}function m(e){let{value:t,onChange:r,onSubmit:s,disabled:o,onImageSelect:l,onVideoSelect:i,onVoiceRecord:d,onNext:c,sendingMedia:u,uploadProgress:m,isWaiting:g}=e,x=(0,n.useRef)(null),p=(0,n.useRef)(null),[b,h]=(0,n.useState)(!1),f=(0,n.useRef)(null),y=(0,n.useRef)(null),v=(0,n.useRef)([]);(0,n.useEffect)(()=>()=>{b&&f.current&&f.current.stop(),y.current&&y.current.getTracks().forEach(e=>e.stop())},[b]);let w=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!r)return;if(r.size>5242880){alert("Image must be less than 5MB");return}let a=new FileReader;a.onload=()=>l({base64:a.result,name:r.name}),a.onerror=()=>alert("Failed to read image"),a.readAsDataURL(r)},j=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!r)return;if(r.size>10485760){alert("Video must be less than 10MB");return}let a=new FileReader;a.onload=()=>{let e=document.createElement("video");e.src=a.result,e.onloadedmetadata=()=>{let t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;let n=t.getContext("2d");n&&(n.drawImage(e,0,0),i({base64:a.result,thumbnail:t.toDataURL("image/jpeg",.7),duration:Math.ceil(e.duration),name:r.name}))},e.onerror=()=>alert("Failed to process video")},a.onerror=()=>alert("Failed to read video"),a.readAsDataURL(r)},N=async()=>{try{v.current=[];let e=await navigator.mediaDevices.getUserMedia({audio:!0});y.current=e;let t=new MediaRecorder(e);t.ondataavailable=e=>{e.data.size>0&&v.current.push(e.data)},t.onstop=async()=>{let t=new Blob(v.current,{type:"audio/webm"});if(0===t.size){alert("No audio recorded");return}let r=URL.createObjectURL(t),a=new Audio(r);a.onloadedmetadata=()=>{d({blob:t,duration:Math.ceil(a.duration)}),URL.revokeObjectURL(r)},a.onerror=()=>{URL.revokeObjectURL(r),d({blob:t,duration:0})},e.getTracks().forEach(e=>e.stop()),y.current=null},f.current=t,t.start(),h(!0)}catch(e){console.error("Microphone error:",e),alert("Please allow microphone access")}};return(0,a.jsxs)("div",{className:"bg-white border-t border-gray-300 p-3 md:p-4",children:[u&&m>0&&(0,a.jsx)("div",{className:"mb-2 h-1 bg-gray-300 rounded overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-blue-500 transition-all duration-150",style:{width:"".concat(m,"%")}})}),g&&(0,a.jsx)("div",{className:"mb-2 text-xs md:text-sm text-gray-600 text-center animate-pulse",children:"\uD83D\uDCAD Waiting for stranger..."}),(0,a.jsxs)("div",{className:"flex gap-2 items-center mb-2",children:[(0,a.jsx)("input",{type:"text",value:t,onChange:r,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),s(e))},placeholder:"Type message...",disabled:o||null!==u,className:"flex-1 border-2 border-gray-300 rounded-lg px-4 py-2 md:py-3 text-sm md:text-base focus:outline-none focus:border-blue-500 disabled:bg-gray-100"}),(0,a.jsx)("button",{onClick:s,disabled:o||!t.trim()||null!==u,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white rounded-lg p-2 md:p-3 transition flex-shrink-0 text-lg",title:"Send (Enter)",children:"\uD83D\uDCE4"}),(0,a.jsx)("button",{onClick:c,disabled:o,className:"bg-orange-500 hover:bg-orange-600 disabled:bg-gray-400 text-white rounded-lg p-2 md:p-3 transition flex-shrink-0 text-lg",title:"Next Stranger",children:"➡️"})]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-center md:justify-start flex-wrap",children:[(0,a.jsx)("button",{onClick:()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.click()},disabled:null!==u||o,className:"bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white rounded-lg p-2 md:p-3 transition flex-shrink-0 text-lg",title:"Send Image",children:"\uD83D\uDCF7"}),(0,a.jsx)("input",{ref:x,type:"file",accept:"image/*",onChange:w,className:"hidden"}),(0,a.jsx)("button",{onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},disabled:null!==u||o,className:"bg-pink-500 hover:bg-pink-600 disabled:bg-gray-400 text-white rounded-lg p-2 md:p-3 transition flex-shrink-0 text-lg",title:"Send Video",children:"\uD83C\uDFA5"}),(0,a.jsx)("input",{ref:p,type:"file",accept:"video/*",onChange:j,className:"hidden"}),(0,a.jsx)("button",{onClick:b?()=>{f.current&&b&&(f.current.stop(),h(!1))}:N,disabled:null!==u||o,className:"rounded-lg p-2 md:p-3 transition flex-shrink-0 text-lg text-white ".concat(b?"bg-red-500 hover:bg-red-600 animate-pulse":"bg-purple-500 hover:bg-purple-600 disabled:bg-gray-400"),title:b?"Stop Recording":"Start Recording",children:b?"⏹️":"\uD83C\uDFA4"})]})]})}function g(e){let{message:t,senderType:r,userName:s}=e,[o,l]=(0,n.useState)(!1);return(0,a.jsx)("div",{className:"flex gap-2 mb-2 ".concat("you"===r?"justify-end":"justify-start"," group"),children:(0,a.jsxs)("div",{className:"max-w-xs md:max-w-md ".concat("you"===r?"":"order-1"),children:["stranger"===r&&s&&(0,a.jsx)("p",{className:"text-xs font-bold text-gray-600 mb-1 px-1",children:s}),(0,a.jsxs)("div",{className:"px-4 py-2 md:py-3 rounded-2xl shadow-md animate-scalePop relative group/message ".concat("you"===r?"bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-br-none":"bg-gray-200 text-gray-900 rounded-bl-none"),children:[(0,a.jsx)("p",{className:"text-sm md:text-base break-words",children:t.text}),(0,a.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(t.text),l(!0),setTimeout(()=>l(!1),2e3)},className:"absolute -top-8 right-0 p-1 rounded opacity-0 group-hover/message:opacity-100 transition-opacity text-xs font-semibold ".concat("you"===r?"bg-purple-700 text-white":"bg-gray-300 text-gray-900"),title:"Copy message",children:o?"✅ Copied":"\uD83D\uDCCB Copy"})]})]})})}function x(e){let{message:t,senderType:r}=e,[s,o]=(0,n.useState)(!1),[l,i]=(0,n.useState)(!1),[d,c]=(0,n.useState)(!1),u=async()=>{try{c(!0),console.log("\uD83D\uDCE5 Converting and downloading...");let e=await fetch(t.mediaUrl),r=await e.blob(),a=URL.createObjectURL(r),n=document.createElement("a");n.href=a;let s="download";"video"===t.type?s="video-".concat(Date.now(),".mp4"):"image"===t.type?s="image-".concat(Date.now(),".jpg"):"voice"===t.type&&(s="voice-".concat(Date.now(),".mp3")),n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),console.log("✅ Downloaded:",s),c(!1)}catch(e){console.error("❌ Download error:",e),alert("Error downloading file"),c(!1)}};return"image"===t.type?(0,a.jsx)("div",{className:"flex ".concat("you"===r?"justify-end":"justify-start"," mb-2 group"),children:(0,a.jsx)("div",{className:"max-w-xs md:max-w-md relative",children:s?(0,a.jsx)("div",{className:"bg-red-100 border-2 border-red-500 rounded-xl p-4 text-center text-red-600 text-sm font-semibold",children:"❌ Image failed to load"}):(0,a.jsxs)("div",{className:"relative group/image",children:[(0,a.jsx)("img",{src:t.mediaUrl,alt:"Sent image",className:"max-w-full max-h-80 rounded-2xl shadow-md object-cover animate-scalePop",onError:()=>{console.error("❌ Image load error"),o(!0)},loading:"lazy"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover/image:bg-opacity-40 rounded-2xl transition-all flex items-center justify-center gap-2 opacity-0 group-hover/image:opacity-100",children:(0,a.jsx)("button",{onClick:u,disabled:d,className:"p-2 bg-white rounded-full hover:bg-gray-200 transition active:scale-95 disabled:opacity-60",title:"Download Image",children:d?"⏳":"\uD83D\uDCE5"})})]})})}):"video"===t.type?(0,a.jsx)("div",{className:"flex ".concat("you"===r?"justify-end":"justify-start"," mb-2"),children:(0,a.jsx)("div",{className:"max-w-xs md:max-w-md",children:s?(0,a.jsx)("div",{className:"bg-red-100 border-2 border-red-500 rounded-xl p-4 text-center text-red-600 text-sm font-semibold",children:"❌ Video failed to load"}):(0,a.jsxs)("div",{className:"relative group/video",children:[(0,a.jsx)("video",{src:t.mediaUrl,controls:!0,className:"w-full max-h-80 rounded-2xl shadow-md object-contain bg-black",poster:t.thumbnail,onError:e=>{console.error("❌ Video load error:",e),o(!0)},controlsList:"nodownload",preload:"metadata"}),t.duration&&(0,a.jsxs)("span",{className:"absolute bottom-2 right-2 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded font-semibold",children:["⏱️ ",t.duration,"s"]}),(0,a.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover/video:opacity-100 transition-opacity",children:(0,a.jsx)("button",{onClick:u,disabled:d,className:"p-2 bg-white rounded-full hover:bg-gray-200 transition active:scale-95 disabled:opacity-60 shadow-md",title:"Download Video",children:d?"⏳":"\uD83D\uDCE5"})})]})})}):"voice"===t.type?(0,a.jsx)("div",{className:"flex ".concat("you"===r?"justify-end":"justify-start"," mb-2"),children:(0,a.jsxs)("div",{className:"bg-gray-100 rounded-2xl px-4 py-3 flex items-center gap-2 shadow-md max-w-xs animate-scalePop group/voice",children:[(0,a.jsx)("button",{onClick:()=>i(!l),className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-600 text-white rounded-full flex items-center justify-center hover:shadow-md transition-all active:scale-95 flex-shrink-0",title:l?"Pause":"Play",children:l?"⏸️":"▶️"}),(0,a.jsx)("audio",{src:t.mediaUrl,controls:!0,className:"flex-1 h-8",autoPlay:l,onError:e=>{console.error("❌ Audio load error:",e),o(!0)},controlsList:"nodownload"}),t.duration&&(0,a.jsxs)("span",{className:"text-xs font-semibold text-gray-600 min-w-max",children:[t.duration,"s"]}),(0,a.jsx)("button",{onClick:u,disabled:d,className:"p-2 bg-white rounded-full hover:bg-gray-200 transition active:scale-95 disabled:opacity-60 flex-shrink-0",title:"Download Voice",children:d?"⏳":"\uD83D\uDCE5"})]})}):null}function p(e){let{strangerName:t}=e;return(0,a.jsx)("div",{className:"flex gap-2 mb-2 animate-slideIn",children:(0,a.jsxs)("div",{className:"flex items-center gap-1 px-4 py-2 bg-gray-200 text-gray-900 rounded-2xl rounded-bl-none shadow-md",children:[(0,a.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,a.jsx)("span",{className:"w-2 h-2 bg-gray-600 rounded-full animate-bounce"}),(0,a.jsx)("span",{className:"w-2 h-2 bg-gray-600 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("span",{className:"w-2 h-2 bg-gray-600 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,a.jsxs)("span",{className:"text-xs font-semibold text-gray-600 ml-1",children:["typing",(0,a.jsx)("span",{className:"animate-pulse",children:"..."})]})]})})}function b(){let[e,t]=(0,n.useState)([]),[r,o]=(0,n.useState)(""),[l,i]=(0,n.useState)("Connecting..."),[d,b]=(0,n.useState)(!1),[h,f]=(0,n.useState)(!1),[y,v]=(0,n.useState)(null),[w,j]=(0,n.useState)("Stranger"),[N,D]=(0,n.useState)(null),[C,S]=(0,n.useState)(0),[k,I]=(0,n.useState)(new Map),[R,U]=(0,n.useState)(!1),E=(0,n.useRef)(null),A=(0,n.useRef)(null),{user:T,logout:L}=(0,s.useAuth)(),M=(0,n.useRef)(null),F=(0,n.useRef)(null),V=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(!T)return;console.log("\uD83D\uDD0C Initializing Socket.IO with keepalive"),E.current=c();let e=E.current;return e.emit("user info",{userId:T.uid,email:T.email,displayName:T.displayName||T.email.split("@")[0]}),e.on("connect",()=>{console.log("✅ Socket connected"),i("Connected"),b(!0),U(!1),F.current&&clearTimeout(F.current)}),e.on("connect_error",e=>{console.error("❌ Connect error:",e.message),i("⚠️ Connection error - retrying...")}),e.on("disconnect",t=>{console.log("❌ Disconnected:",t),b(!1),i("❌ Disconnected: "+t),"io server disconnect"===t&&(F.current=setTimeout(()=>{console.log("\uD83D\uDD04 Attempting to reconnect..."),e.connect()},2e3))}),e.on("waiting",e=>{i(e.message),b(!1),U(!0),j("Stranger")}),e.on("paired",e=>{v(e.roomId),i("✅ Connected to a stranger"),b(!0),U(!1),t([]),j("Stranger")}),e.on("chat message",e=>{console.log("\uD83D\uDCAC Message received:",e.type),e.userName&&"Anonymous"!==e.userName&&j(e.userName),t(t=>[...t,{id:e.id||Date.now().toString(),text:e.message,type:e.type||"text",mediaUrl:e.mediaUrl,thumbnail:e.thumbnail,duration:e.duration,senderType:"stranger",userName:e.userName||"Stranger",timestamp:new Date}]),f(!1),setTimeout(()=>{var e;null===(e=A.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},50)}),e.on("media upload ack",e=>{console.log("✅ Media upload confirmed:",e);let{tempId:r,id:a,mediaUrl:n,thumbnail:s,duration:o}=e;t(e=>{let t=[...e],l=t.findIndex(e=>e.tempId===r);return -1!==l&&(t[l]={...t[l],id:a||r,mediaUrl:n||t[l].mediaUrl,thumbnail:s||t[l].thumbnail,duration:o||t[l].duration,status:"confirmed"}),t}),I(e=>{let t=new Map(e);return t.delete(r),t}),D(null),S(0)}),e.on("typing",e=>{f(e.isTyping)}),e.on("stranger left",e=>{console.log("\uD83D\uDC4B Stranger left"),i("❌ "+e.message),b(!1),v(null),f(!1),j("Stranger"),I(new Map)}),()=>{F.current&&clearTimeout(F.current),V.current&&clearInterval(V.current),e.off("connect"),e.off("connect_error"),e.off("disconnect"),e.off("waiting"),e.off("paired"),e.off("chat message"),e.off("media upload ack"),e.off("typing"),e.off("stranger left")}},[T]);let P=async e=>{if(!d||!E.current||!y)return;let r=Date.now().toString();D("voice"),S(5),t(t=>[...t,{id:r,tempId:r,text:"\uD83C\uDFA4 Voice message (uploading...)",type:"voice",mediaUrl:null,duration:e.duration||0,senderType:"you",userName:T.displayName||"You",timestamp:new Date,status:"uploading"}]),I(t=>new Map(t).set(r,{type:"voice",data:e}));try{let t=new FileReader;t.onprogress=e=>{if(e.lengthComputable){let t=5+Math.round(e.loaded/e.total*85);S(t)}},t.onload=()=>{S(100);let a=t.result;E.current.emit("chat message",{message:"\uD83C\uDFA4 Voice message",type:"voice",mediaUrl:a,duration:e.duration||0,tempId:r,roomId:y,userId:T.uid,userName:T.displayName||"Anonymous"}),setTimeout(()=>{var e;null===(e=A.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},50)},t.readAsDataURL(e.blob)}catch(e){console.error("❌ Voice error:",e),t(e=>e.filter(e=>e.tempId!==r)),I(e=>{let t=new Map(e);return t.delete(r),t}),D(null),S(0)}},O=async e=>{if(!d||!E.current||!y)return;let r=Date.now().toString();D("image"),S(5),t(e=>[...e,{id:r,tempId:r,text:"\uD83D\uDCF7 Image (uploading...)",type:"image",mediaUrl:null,senderType:"you",userName:T.displayName||"You",timestamp:new Date,status:"uploading"}]),I(t=>new Map(t).set(r,{type:"image",data:e}));try{E.current.emit("chat message",{message:"\uD83D\uDCF7 Image",type:"image",mediaUrl:e.base64,tempId:r,roomId:y,userId:T.uid,userName:T.displayName||"Anonymous"}),setTimeout(()=>{var e;null===(e=A.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},50)}catch(e){console.error("❌ Image error:",e),t(e=>e.filter(e=>e.tempId!==r)),I(e=>{let t=new Map(e);return t.delete(r),t}),D(null),S(0)}},_=async e=>{if(!d||!E.current||!y)return;console.log("\uD83C\uDFA5 SENDING VIDEO");let r=Date.now().toString();D("video"),S(5),t(t=>[...t,{id:r,tempId:r,text:"\uD83C\uDFA5 Video (uploading...)",type:"video",mediaUrl:null,thumbnail:null,duration:e.duration,senderType:"you",userName:T.displayName||"You",timestamp:new Date,status:"uploading"}]),I(t=>new Map(t).set(r,{type:"video",data:e}));try{let t=5,a=Date.now();V.current&&clearInterval(V.current),V.current=setInterval(()=>{let e=Date.now()-a;(t=5+e/2e3*95)>=100&&(t=100,clearInterval(V.current)),S(Math.floor(t))},50),E.current.emit("chat message",{message:"\uD83C\uDFA5 Video",type:"video",mediaUrl:e.base64,thumbnail:e.thumbnail,duration:e.duration,tempId:r,roomId:y,userId:T.uid,userName:T.displayName||"Anonymous"}),setTimeout(()=>{var e;null===(e=A.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},50)}catch(e){console.error("❌ Video error:",e),alert("Error sending video: "+e.message),t(e=>e.filter(e=>e.tempId!==r)),I(e=>{let t=new Map(e);return t.delete(r),t}),V.current&&clearInterval(V.current),D(null),S(0)}},B=async()=>{E.current&&E.current.disconnect(),await L()};return(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-white",children:[(0,a.jsx)(u,{status:l,user:T,onLogout:B}),(0,a.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto scrollbar-thin p-4 md:p-5 space-y-3",children:[0===e.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-center",children:(0,a.jsx)("p",{className:"text-gray-500 text-lg",children:d?"✅ Start a conversation...":"⏳ "+l})}):(0,a.jsxs)(a.Fragment,{children:[e.map(e=>"text"===e.type?(0,a.jsx)(g,{message:e,senderType:e.senderType,userName:e.userName},e.id):(0,a.jsx)(x,{message:e,senderType:e.senderType},e.id)),h&&(0,a.jsx)(p,{strangerName:w})]}),(0,a.jsx)("div",{ref:A})]}),(0,a.jsx)(m,{value:r,onChange:e=>{o(e.target.value),d&&E.current&&y&&(E.current.emit("typing",{isTyping:!0,roomId:y}),M.current&&clearTimeout(M.current),M.current=setTimeout(()=>{E.current&&y&&E.current.emit("typing",{isTyping:!1,roomId:y})},1e3))},onSubmit:e=>{if(e.preventDefault(),!r.trim()||!d||!E.current||!y)return;let a=r.trim();E.current.emit("chat message",{message:a,type:"text",roomId:y,userId:T.uid,userName:T.displayName||"Anonymous"}),t(e=>[...e,{id:Date.now().toString(),text:a,type:"text",senderType:"you",userName:T.displayName||"You",timestamp:new Date}]),o(""),setTimeout(()=>{var e;null===(e=A.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},50)},disabled:!d,onVoiceRecord:P,onImageSelect:O,onVideoSelect:_,onNext:()=>{E.current&&(t([]),v(null),f(!1),b(!1),U(!0),i("Looking for a new stranger..."),j("Stranger"),I(new Map),E.current.emit("find next"))},sendingMedia:N,uploadProgress:C,isWaiting:R})]})]})}function h(){let[e,t]=(0,n.useState)(!0),{user:r,loading:i}=(0,s.useAuth)();return((0,n.useEffect)(()=>{console.log("\uD83C\uDFAF AuthWrapper state update:",{userEmail:null==r?void 0:r.email,loading:i,isLoginMode:e})},[r,i,e]),i)?(console.log("⏳ Still loading..."),(0,a.jsxs)("div",{className:"loading-container",children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("p",{children:"Loading..."})]})):r?(console.log("✅ User logged in, showing chat page"),(0,a.jsx)(b,{})):(console.log("\uD83D\uDCDD No user, showing login form"),e?(0,a.jsx)(o,{onToggleMode:()=>t(!1)}):(0,a.jsx)(l,{onToggleMode:()=>t(!0)}))}function f(){return(0,a.jsx)(h,{})}}},function(e){e.O(0,[358,487,647,732,662,971,938,744],function(){return e(e.s=5725)}),_N_E=e.O()}]);