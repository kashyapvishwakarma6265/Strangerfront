(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{910:function(e,t,a){Promise.resolve().then(a.bind(a,3942))},3942:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var r=a(7437),s=a(2265),n=a(4662);function l(e){let{onToggleMode:t}=e,[a,l]=(0,s.useState)(""),[i,o]=(0,s.useState)(""),[d,u]=(0,s.useState)(""),[c,m]=(0,s.useState)(!1),[g,x]=(0,s.useState)(!1),[b,p]=(0,s.useState)(""),[h,f]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1),{login:w,googleLogin:D,resetPassword:N,error:j}=(0,n.useAuth)(),C=async e=>{e.preventDefault(),u(""),m(!0);try{await w(a,i)}catch(e){u(e.message||"Login failed"),m(!1)}},S=async()=>{u(""),m(!0);try{await D()}catch(e){m(!1)}},k=async e=>{e.preventDefault(),u(""),f(!0);try{await N(b),v(!0),setTimeout(()=>{x(!1),p(""),v(!1)},3e3)}catch(e){u(e.message)}finally{f(!1)}};return g?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideUp",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-900 text-center mb-2",children:"\uD83D\uDD11 Reset Password"}),(0,r.jsx)("p",{className:"text-gray-600 text-center text-sm mb-6",children:"Enter your email to receive reset link"}),y&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-green-100 border-l-4 border-green-500 text-green-700 text-sm rounded animate-slideDown",children:"✅ Password reset email sent! Check your inbox."}),(d||j)&&!y&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 text-sm rounded animate-slideDown",children:d||j}),(0,r.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[(0,r.jsx)("input",{type:"email",placeholder:"Enter your email",value:b,onChange:e=>p(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsx)("button",{type:"submit",disabled:h,className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:shadow-lg transition disabled:opacity-60",children:h?"⏳ Sending...":"\uD83D\uDCE7 Send Reset Email"})]}),(0,r.jsx)("button",{onClick:()=>x(!1),className:"mt-4 w-full text-center text-blue-600 font-semibold hover:text-blue-700 transition",children:"← Back to Login"})]})}):(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideUp",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"\uD83D\uDD37 Welcome Back"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm",children:"Login to your account"})]}),(d||j)&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 text-sm rounded animate-slideDown",children:d||j}),(0,r.jsxs)("form",{onSubmit:C,className:"space-y-4 mb-6",children:[(0,r.jsx)("input",{type:"email",placeholder:"Email",value:a,onChange:e=>l(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsx)("input",{type:"password",placeholder:"Password",value:i,onChange:e=>o(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsx)("button",{type:"submit",disabled:c,className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:shadow-lg transition disabled:opacity-60",children:c?"⏳ Logging in...":"\uD83D\uDD10 Login"})]}),(0,r.jsx)("button",{onClick:()=>x(!0),className:"block w-full text-center text-blue-600 font-semibold mb-6 hover:text-blue-700 transition",children:"\uD83D\uDD11 Forgot Password?"}),(0,r.jsxs)("div",{className:"relative mb-6",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,r.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,r.jsx)("div",{className:"relative flex justify-center",children:(0,r.jsx)("span",{className:"px-2 bg-white text-gray-600 text-sm",children:"OR"})})]}),(0,r.jsx)("button",{onClick:S,disabled:c,className:"w-full py-3 bg-white border-2 border-gray-300 text-gray-900 font-semibold rounded-lg hover:bg-gray-50 transition disabled:opacity-60 mb-6",children:"\uD83D\uDD37 Continue with Google"}),(0,r.jsxs)("p",{className:"text-center text-gray-600 text-sm",children:["Don't have an account?"," ",(0,r.jsx)("button",{onClick:t,className:"text-blue-600 font-semibold hover:text-blue-700 transition",children:"Sign up here"})]})]})})}function i(e){let{onToggleMode:t}=e,[a,l]=(0,s.useState)(""),[i,o]=(0,s.useState)(""),[d,u]=(0,s.useState)(""),[c,m]=(0,s.useState)(""),[g,x]=(0,s.useState)(""),[b,p]=(0,s.useState)(!1),[h,f]=(0,s.useState)(!1),{signup:y,error:v}=(0,n.useAuth)(),w=async e=>{if(e.preventDefault(),x(""),!h){x("Please agree to the terms and conditions");return}if(i!==d){x("Passwords do not match");return}if(i.length<6){x("Password must be at least 6 characters");return}if(c.length<2){x("Display name must be at least 2 characters");return}p(!0);try{await y(a,i,c)}catch(e){x(e.message),p(!1)}};return(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideUp",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"\uD83C\uDF89 Create Account"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm",children:"Join our community"})]}),(g||v)&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 text-sm rounded animate-slideDown",children:g||v}),(0,r.jsxs)("form",{onSubmit:w,className:"space-y-4 mb-6",children:[(0,r.jsx)("input",{type:"text",placeholder:"Display Name",value:c,onChange:e=>m(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsx)("input",{type:"email",placeholder:"Email",value:a,onChange:e=>l(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsx)("input",{type:"password",placeholder:"Password (min. 6 characters)",value:i,onChange:e=>o(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsx)("input",{type:"password",placeholder:"Confirm Password",value:d,onChange:e=>u(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("input",{type:"checkbox",id:"terms",checked:h,onChange:e=>f(e.target.checked),className:"mt-1 w-4 h-4 cursor-pointer accent-blue-600"}),(0,r.jsx)("label",{htmlFor:"terms",className:"text-sm text-gray-700 cursor-pointer",children:"I agree to Terms & Conditions"})]}),(0,r.jsx)("button",{type:"submit",disabled:b,className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:shadow-lg transition disabled:opacity-60",children:b?"⏳ Creating Account...":"✨ Sign Up"})]}),(0,r.jsxs)("p",{className:"text-center text-gray-600 text-sm",children:["Already have an account?"," ",(0,r.jsx)("button",{onClick:t,className:"text-blue-600 font-semibold hover:text-blue-700 transition",children:"Login here"})]})]})})}var o=a(5732);let d=null,u=()=>{if(d)return d;let e="https://strangerback.onrender.com";return e?d=(0,o.io)(e,{}):(console.error("❌ NEXT_PUBLIC_SOCKET_URL is not set. Please check your .env.local file!"),null)};function c(e){var t;let{status:a,user:s,onLogout:n,isConnected:l}=e;return(0,r.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-500 text-white px-3 md:px-6 py-2.5 md:py-4 shadow-lg flex justify-between items-center gap-2 md:gap-4 flex-wrap md:flex-nowrap",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 md:gap-3 min-w-0 flex-1",children:[(0,r.jsx)("div",{className:"w-7 h-7 md:w-10 md:h-10 bg-white bg-opacity-30 rounded-full flex items-center justify-center text-base md:text-xl flex-shrink-0",children:"\uD83D\uDCAC"}),(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("h1",{className:"text-base md:text-2xl font-bold truncate",children:"Blink Chat"}),(0,r.jsx)("p",{className:"text-xs md:text-sm opacity-90 truncate",children:a})]})]}),l&&(0,r.jsxs)("div",{className:"hidden sm:flex items-center gap-2 text-xs md:text-sm flex-shrink-0",children:[(0,r.jsx)("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),(0,r.jsx)("span",{children:"Connected"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5 md:gap-4 min-w-0 flex-shrink-0",children:[(0,r.jsx)("span",{className:"text-xs md:text-sm font-semibold text-right truncate max-w-xs",children:(null==s?void 0:s.displayName)||(null==s?void 0:null===(t=s.email)||void 0===t?void 0:t.split("@")[0])||"Guest"}),(0,r.jsx)("button",{onClick:n,className:"px-2.5 md:px-4 py-1.5 md:py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition text-xs md:text-base font-semibold flex-shrink-0",children:"Logout"})]})]})}let m=["\uD83D\uDE00","\uD83D\uDE03","\uD83D\uDE04","\uD83D\uDE01","\uD83D\uDE06","\uD83D\uDE05","\uD83E\uDD23","\uD83D\uDE02","\uD83D\uDE42","\uD83D\uDE0D","\uD83D\uDC4D","\uD83D\uDC4F","❤️","\uD83C\uDF89","\uD83D\uDD25","✨"];function g(e){let{isOpen:t,onEmojiSelect:a,onClose:s}=e;return t?(0,r.jsxs)("div",{className:"absolute bottom-full left-0 z-50 bg-white border rounded-xl shadow p-2 w-72",children:[(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:m.map(e=>(0,r.jsx)("button",{className:"text-2xl p-2",onClick:()=>a(e),children:e},e))}),(0,r.jsx)("button",{className:"mt-2 text-sm text-gray-500",onClick:s,children:"Close"})]}):null}function x(e){let{value:t,onChange:a,onSubmit:n,disabled:l,onImageSelect:i,onVideoSelect:o,onVoiceRecord:d,onNext:u,sendingMedia:c,uploadProgress:m,isWaiting:x}=e,b=(0,s.useRef)(null),p=(0,s.useRef)(null),[h,f]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1),w=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e),a=[];t.ondataavailable=e=>a.push(e.data),t.onstop=()=>{let e=new Blob(a,{type:"audio/webm"});d({blob:e,duration:0}),f(!1)},f(!0),t.start(),setTimeout(()=>{"inactive"!==t.state&&t.stop()},6e4)}catch(e){alert("Microphone error. Please allow permission.")}};return(0,r.jsxs)("form",{className:"bg-white border-t border-gray-300 p-3 md:p-4 flex flex-col relative",onSubmit:e=>{e.preventDefault(),n(e)},autoComplete:"off",children:[y&&(0,r.jsx)(g,{isOpen:!0,onEmojiSelect:e=>{a({target:{value:t+e}}),v(!1)},onClose:()=>v(!1)}),c&&m>0&&(0,r.jsx)("div",{className:"mb-2 h-1 bg-gray-300 rounded overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-blue-500 transition-all",style:{width:"".concat(m,"%")}})}),x&&(0,r.jsx)("div",{className:"mb-2 text-xs text-gray-600 text-center animate-pulse",children:"\uD83D\uDCAD Waiting for stranger..."}),(0,r.jsxs)("div",{className:"flex gap-2 items-center mb-2",children:[(0,r.jsx)("input",{type:"text",value:t,onChange:a,placeholder:"Type message…",disabled:l||null!=c,className:"flex-1 border-2 border-gray-300 rounded-lg px-4 py-2 md:py-3 text-base focus:outline-none focus:border-blue-500 disabled:bg-gray-100",autoFocus:!0}),(0,r.jsx)("button",{type:"submit",disabled:l||!t.trim()||null!=c,className:"bg-blue-500 hover:bg-blue-600 text-white rounded-lg p-2",title:"Send",children:"\uD83D\uDCE4"}),(0,r.jsx)("button",{type:"button",onClick:u,disabled:l,className:"bg-orange-500 hover:bg-orange-600 text-white rounded-lg p-2",title:"Next Stranger",children:"➡️"}),(0,r.jsx)("button",{type:"button",className:"bg-yellow-400 hover:bg-yellow-500 text-white rounded-lg p-2",title:"Send Emoji",onClick:()=>v(!0),disabled:null!=c||l,children:"\uD83D\uDE42"})]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-start flex-wrap",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=b.current)||void 0===e?void 0:e.click()},disabled:null!=c||l,className:"bg-green-500 hover:bg-green-600 text-white rounded-lg p-2",title:"Send Image",children:"\uD83D\uDCF7"}),(0,r.jsx)("input",{ref:b,type:"file",accept:"image/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;if(!a.type.startsWith("image/")||a.size>10485760){alert("Please select an image below 10MB.");return}let r=new FileReader;r.onload=()=>i({base64:r.result,name:a.name}),r.onerror=()=>alert("Image couldn't be loaded."),r.readAsDataURL(a),e.target.value=""},className:"hidden"}),(0,r.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},disabled:null!=c||l,className:"bg-pink-500 hover:bg-pink-600 text-white rounded-lg p-2",title:"Send Video",children:"\uD83C\uDFA5"}),(0,r.jsx)("input",{ref:p,type:"file",accept:"video/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;if(!a.type.startsWith("video/")||a.size>20971520){alert("Please select a video below 20MB.");return}let r=new FileReader;r.onload=()=>{let e=document.createElement("video");e.src=r.result,e.onloadedmetadata=()=>{let t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0),o({base64:r.result,thumbnail:t.toDataURL("image/jpeg",.7),duration:Math.round(e.duration),name:a.name})},e.onerror=()=>alert("Video couldn't be loaded.")},r.readAsDataURL(a),e.target.value=""},className:"hidden"}),(0,r.jsxs)("div",{children:[h?(0,r.jsx)("button",{type:"button",onClick:()=>f(!1),className:"bg-red-600 hover:bg-red-700 text-white rounded-lg p-2 ml-2",disabled:l,title:"Stop Recording",children:"⏹ Stop"}):(0,r.jsx)("button",{type:"button",onClick:w,className:"bg-purple-500 hover:bg-purple-600 text-white rounded-lg p-2",disabled:null!=c||l,title:"Record Voice",children:"\uD83C\uDFA4 Record"}),h&&(0,r.jsx)("span",{className:"ml-2 text-red-500 font-bold",children:"Recording..."})]})]})]})}function b(e){let{message:t,senderType:a}=e,s="you"===a;return(0,r.jsx)("div",{className:"flex mb-2 ".concat(s?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"rounded-xl p-3 max-w-xs shadow-md ".concat(s?"bg-blue-500 text-white rounded-br-none":"bg-gray-200 text-gray-900 rounded-bl-none"),children:[(0,r.jsx)("div",{className:"text-xs font-bold mb-1 ".concat(s?"text-blue-200 text-right":"text-gray-500 text-left"),children:s?"".concat(t.userName||"You"," (Sent)"):"".concat(t.userName||"Anon"," (Received)")}),"text"===t.type&&(0,r.jsx)("span",{children:t.text}),"image"===t.type&&(0,r.jsx)("img",{src:t.mediaUrl,alt:"media",className:"rounded max-w-full my-1"}),"video"===t.type&&(0,r.jsx)("video",{controls:!0,className:"rounded max-w-full my-1",style:{maxHeight:240},children:(0,r.jsx)("source",{src:t.mediaUrl})}),"voice"===t.type&&(0,r.jsx)("audio",{controls:!0,className:"w-full mt-1",children:(0,r.jsx)("source",{src:t.mediaUrl})}),(0,r.jsx)("div",{className:"text-[10px] mt-1 text-gray-300 text-right",children:t.timestamp&&new Date(t.timestamp).toLocaleTimeString()})]})})}function p(e){let{strangerName:t}=e;return(0,r.jsx)("div",{className:"flex gap-2 mb-2 animate-slideIn",children:(0,r.jsxs)("div",{className:"flex items-center gap-1 px-4 py-2 bg-gray-200 text-gray-900 rounded-2xl rounded-bl-none shadow-md",children:[(0,r.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,r.jsx)("span",{className:"w-2 h-2 bg-gray-600 rounded-full animate-bounce"}),(0,r.jsx)("span",{className:"w-2 h-2 bg-gray-600 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,r.jsx)("span",{className:"w-2 h-2 bg-gray-600 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,r.jsxs)("span",{className:"text-xs font-semibold text-gray-600 ml-1",children:[t||"Stranger"," is typing",(0,r.jsx)("span",{className:"animate-pulse",children:"..."})]})]})})}function h(){let[e,t]=(0,s.useState)([]),[a,l]=(0,s.useState)(""),[i,o]=(0,s.useState)("Connecting..."),[d,m]=(0,s.useState)(!1),[g,h]=(0,s.useState)(!1),[f,y]=(0,s.useState)(null),[v,w]=(0,s.useState)("Stranger"),[D,N]=(0,s.useState)(null),[j,C]=(0,s.useState)(0),[S,k]=(0,s.useState)(new Map),[E,T]=(0,s.useState)(!1),R=(0,s.useRef)(null),I=(0,s.useRef)(null),{user:U,logout:A}=(0,n.useAuth)(),F=(0,s.useRef)(null),L=(0,s.useRef)(null),P=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!U)return;R.current=u();let e=R.current;return e.emit("user info",{userId:U.uid,email:U.email,displayName:U.displayName||U.email.split("@")[0]}),e.on("connect",()=>{o("Connected"),m(!0),T(!1),L.current&&clearTimeout(L.current)}),e.on("connect_error",()=>o("⚠️ Connection error - retrying...")),e.on("disconnect",t=>{m(!1),o("❌ Disconnected: "+t),"io server disconnect"===t&&(L.current=setTimeout(()=>e.connect(),2e3))}),e.on("waiting",e=>{o(e.message),m(!1),T(!0),w("Stranger")}),e.on("paired",e=>{y(e.roomId),o("✅ Connected to a stranger"),m(!0),T(!1),t([]),w("Stranger")}),e.on("chat message",e=>{t(t=>[...t,{id:e.id||Date.now().toString(),text:e.message,type:e.type||"text",mediaUrl:e.mediaUrl,thumbnail:e.thumbnail,duration:e.duration,senderType:"stranger",userName:e.userName||"Stranger",timestamp:new Date}]),h(!1),setTimeout(()=>{var e;return null===(e=I.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})},50)}),e.on("media upload ack",e=>{}),e.on("typing",e=>h(e.isTyping)),e.on("stranger left",e=>{o("❌ "+e.message),m(!1),y(null),h(!1),w("Stranger"),k(new Map)}),()=>{L.current&&clearTimeout(L.current),P.current&&clearInterval(P.current),e.off("connect"),e.off("connect_error"),e.off("disconnect"),e.off("waiting"),e.off("paired"),e.off("chat message"),e.off("media upload ack"),e.off("typing"),e.off("stranger left")}},[U]);let M=async e=>{if(d&&R.current&&f){N("voice"),C(5);try{let a=new FileReader;a.onload=()=>{let r=a.result;R.current.emit("chat message",{message:"\uD83C\uDFA4 Voice message",type:"voice",mediaUrl:r,duration:e.duration||0,roomId:f,userId:U.uid,userName:U.displayName||U.email,thumbnail:null}),t(e=>[...e,{id:Date.now().toString(),text:"\uD83C\uDFA4 Voice message",type:"voice",mediaUrl:r,senderType:"you",userName:U.displayName||U.email,timestamp:new Date}]),N(null),C(100)},a.readAsDataURL(e.blob)}catch(e){N(null),C(0)}}},V=async e=>{if(d&&R.current&&f){N("image"),C(5);try{R.current.emit("chat message",{message:"\uD83D\uDCF7 Image",type:"image",mediaUrl:e.base64,roomId:f,userId:U.uid,userName:U.displayName||U.email,thumbnail:null,duration:null}),t(t=>[...t,{id:Date.now().toString(),text:"\uD83D\uDCF7 Image",type:"image",mediaUrl:e.base64,senderType:"you",userName:U.displayName||U.email,timestamp:new Date}]),N(null),C(100)}catch(e){N(null),C(0)}}},_=async e=>{if(d&&R.current&&f){N("video"),C(5);try{R.current.emit("chat message",{message:"\uD83C\uDFA5 Video",type:"video",mediaUrl:e.base64,thumbnail:e.thumbnail,duration:e.duration,roomId:f,userId:U.uid,userName:U.displayName||U.email}),t(t=>[...t,{id:Date.now().toString(),text:"\uD83C\uDFA5 Video",type:"video",mediaUrl:e.base64,thumbnail:e.thumbnail,duration:e.duration,senderType:"you",userName:U.displayName||U.email,timestamp:new Date}]),N(null),C(100)}catch(e){N(null),C(0)}}},q=async()=>{R.current&&R.current.disconnect(),await A()};return(0,r.jsxs)("div",{className:"flex flex-col h-screen bg-white",children:[(0,r.jsx)(c,{status:i,user:U,onLogout:q}),(0,r.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto scrollbar-thin p-4 md:p-5 space-y-3",children:[0===e.length?(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-center",children:(0,r.jsx)("p",{className:"text-gray-500 text-lg",children:d?"✅ Start a conversation...":"⏳ "+i})}):(0,r.jsxs)(r.Fragment,{children:[e.map(e=>(0,r.jsx)(b,{message:e,senderType:e.senderType},e.id)),g&&(0,r.jsx)(p,{strangerName:v})]}),(0,r.jsx)("div",{ref:I})]}),(0,r.jsx)(x,{value:a,onChange:e=>{l(e.target.value),d&&R.current&&f&&(R.current.emit("typing",{isTyping:!0,roomId:f}),F.current&&clearTimeout(F.current),F.current=setTimeout(()=>{R.current&&f&&R.current.emit("typing",{isTyping:!1,roomId:f})},1e3))},onSubmit:e=>{if(e.preventDefault(),!a.trim()||!d||!R.current||!f)return;let r=a.trim();R.current.emit("chat message",{message:r,type:"text",roomId:f,userId:U.uid,userName:U.displayName||U.email,mediaUrl:null,thumbnail:null,duration:null}),t(e=>[...e,{id:Date.now().toString(),text:r,type:"text",senderType:"you",userName:U.displayName||U.email,timestamp:new Date}]),l(""),setTimeout(()=>{var e;return null===(e=I.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})},50)},disabled:!d,onVoiceRecord:M,onImageSelect:V,onVideoSelect:_,onNext:()=>{R.current&&(t([]),y(null),h(!1),m(!1),T(!0),o("Looking for a new stranger..."),w("Stranger"),k(new Map),R.current.emit("find next"))},sendingMedia:D,uploadProgress:j,isWaiting:E})]})]})}function f(){let[e,t]=(0,s.useState)(!0),{user:a,loading:o}=(0,n.useAuth)();return((0,s.useEffect)(()=>{console.log("\uD83C\uDFAF AuthWrapper state update:",{userEmail:null==a?void 0:a.email,loading:o,isLoginMode:e})},[a,o,e]),o)?(console.log("⏳ Still loading..."),(0,r.jsxs)("div",{className:"loading-container",children:[(0,r.jsx)("div",{className:"loading-spinner"}),(0,r.jsx)("p",{children:"Loading..."})]})):a?(console.log("✅ User logged in, showing chat page"),(0,r.jsx)(h,{})):(console.log("\uD83D\uDCDD No user, showing login form"),e?(0,r.jsx)(l,{onToggleMode:()=>t(!1)}):(0,r.jsx)(i,{onToggleMode:()=>t(!0)}))}function y(){return(0,r.jsx)(f,{})}}},function(e){e.O(0,[358,487,647,732,662,971,938,744],function(){return e(e.s=910)}),_N_E=e.O()}]);