(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8786:function(e,t,a){Promise.resolve().then(a.bind(a,9977))},9977:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var r=a(7437),o=a(2265),s=a(4662);function n(e){let{onToggleMode:t}=e,[a,n]=(0,o.useState)(""),[l,i]=(0,o.useState)(""),[d,c]=(0,o.useState)(""),[u,m]=(0,o.useState)(!1),[g,p]=(0,o.useState)(!1),[x,h]=(0,o.useState)(""),[b,f]=(0,o.useState)(!1),[y,w]=(0,o.useState)(!1),{login:v,googleLogin:D,resetPassword:N,error:j}=(0,s.a)(),C=async e=>{e.preventDefault(),c(""),m(!0);try{await v(a,l)}catch(e){c(e.message||"Login failed"),m(!1)}},S=async()=>{c(""),m(!0);try{await D()}catch(e){m(!1)}},k=async e=>{e.preventDefault(),c(""),f(!0);try{await N(x),w(!0),setTimeout(()=>{p(!1),h(""),w(!1)},3e3)}catch(e){c(e.message)}finally{f(!1)}};return g?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideUp",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-900 text-center mb-2",children:"\uD83D\uDD11 Reset Password"}),(0,r.jsx)("p",{className:"text-gray-600 text-center text-sm mb-6",children:"Enter your email to receive reset link"}),y&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-green-100 border-l-4 border-green-500 text-green-700 text-sm rounded animate-slideDown",children:"✅ Password reset email sent! Check your inbox."}),(d||j)&&!y&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 text-sm rounded animate-slideDown",children:d||j}),(0,r.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[(0,r.jsx)("input",{type:"email",placeholder:"Enter your email",value:x,onChange:e=>h(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsx)("button",{type:"submit",disabled:b,className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:shadow-lg transition disabled:opacity-60",children:b?"⏳ Sending...":"\uD83D\uDCE7 Send Reset Email"})]}),(0,r.jsx)("button",{onClick:()=>p(!1),className:"mt-4 w-full text-center text-blue-600 font-semibold hover:text-blue-700 transition",children:"← Back to Login"})]})}):(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideUp",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"\uD83D\uDD37 Welcome Back"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm",children:"Login to your account"})]}),(d||j)&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 text-sm rounded animate-slideDown",children:d||j}),(0,r.jsxs)("form",{onSubmit:C,className:"space-y-4 mb-6",children:[(0,r.jsx)("input",{type:"email",placeholder:"Email",value:a,onChange:e=>n(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsx)("input",{type:"password",placeholder:"Password",value:l,onChange:e=>i(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsx)("button",{type:"submit",disabled:u,className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:shadow-lg transition disabled:opacity-60",children:u?"⏳ Logging in...":"\uD83D\uDD10 Login"})]}),(0,r.jsx)("button",{onClick:()=>p(!0),className:"block w-full text-center text-blue-600 font-semibold mb-6 hover:text-blue-700 transition",children:"\uD83D\uDD11 Forgot Password?"}),(0,r.jsxs)("div",{className:"relative mb-6",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,r.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,r.jsx)("div",{className:"relative flex justify-center",children:(0,r.jsx)("span",{className:"px-2 bg-white text-gray-600 text-sm",children:"OR"})})]}),(0,r.jsx)("button",{onClick:S,disabled:u,className:"w-full py-3 bg-white border-2 border-gray-300 text-gray-900 font-semibold rounded-lg hover:bg-gray-50 transition disabled:opacity-60 mb-6",children:"\uD83D\uDD37 Continue with Google"}),(0,r.jsxs)("p",{className:"text-center text-gray-600 text-sm",children:["Don't have an account?"," ",(0,r.jsx)("button",{onClick:t,className:"text-blue-600 font-semibold hover:text-blue-700 transition",children:"Sign up here"})]})]})})}function l(e){let{onToggleMode:t}=e,[a,n]=(0,o.useState)(""),[l,i]=(0,o.useState)(""),[d,c]=(0,o.useState)(""),[u,m]=(0,o.useState)(""),[g,p]=(0,o.useState)(""),[x,h]=(0,o.useState)(!1),[b,f]=(0,o.useState)(!1),{signup:y,error:w}=(0,s.a)(),v=async e=>{if(e.preventDefault(),p(""),!b){p("Please agree to the terms and conditions");return}if(l!==d){p("Passwords do not match");return}if(l.length<6){p("Password must be at least 6 characters");return}if(u.length<2){p("Display name must be at least 2 characters");return}h(!0);try{await y(a,l,u)}catch(e){p(e.message),h(!1)}};return(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideUp",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"\uD83C\uDF89 Create Account"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm",children:"Join our community"})]}),(g||w)&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 text-sm rounded animate-slideDown",children:g||w}),(0,r.jsxs)("form",{onSubmit:v,className:"space-y-4 mb-6",children:[(0,r.jsx)("input",{type:"text",placeholder:"Display Name",value:u,onChange:e=>m(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsx)("input",{type:"email",placeholder:"Email",value:a,onChange:e=>n(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsx)("input",{type:"password",placeholder:"Password (min. 6 characters)",value:l,onChange:e=>i(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsx)("input",{type:"password",placeholder:"Confirm Password",value:d,onChange:e=>c(e.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:bg-white transition"}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("input",{type:"checkbox",id:"terms",checked:b,onChange:e=>f(e.target.checked),className:"mt-1 w-4 h-4 cursor-pointer accent-blue-600"}),(0,r.jsx)("label",{htmlFor:"terms",className:"text-sm text-gray-700 cursor-pointer",children:"I agree to Terms & Conditions"})]}),(0,r.jsx)("button",{type:"submit",disabled:x,className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:shadow-lg transition disabled:opacity-60",children:x?"⏳ Creating Account...":"✨ Sign Up"})]}),(0,r.jsxs)("p",{className:"text-center text-gray-600 text-sm",children:["Already have an account?"," ",(0,r.jsx)("button",{onClick:t,className:"text-blue-600 font-semibold hover:text-blue-700 transition",children:"Login here"})]})]})})}var i=a(5732);let d=null,c=()=>(d||((d=(0,i.ZP)("https://strangerback.onrender.com",{reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:1/0,transports:["websocket","polling"],maxHttpBufferSize:104857600,timeout:12e4,upgrade:!0,rememberUpgrade:!0,autoConnect:!0})).on("reconnect",e=>{console.log("\uD83D\uDD04 Reconnected after ".concat(e," attempts"))}),d.on("reconnect_error",e=>{console.error("❌ Reconnect error:",e.message)}),d.on("reconnect_failed",()=>{console.error("❌ Reconnection failed")})),d);function u(e){var t;let{status:a,user:o,onLogout:s,isConnected:n}=e;return(0,r.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-500 text-white px-3 md:px-6 py-2.5 md:py-4 shadow-lg flex justify-between items-center gap-2 md:gap-4 flex-wrap md:flex-nowrap",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 md:gap-3 min-w-0 flex-1",children:[(0,r.jsx)("div",{className:"w-7 h-7 md:w-10 md:h-10 bg-white bg-opacity-30 rounded-full flex items-center justify-center text-base md:text-xl flex-shrink-0",children:"\uD83D\uDCAC"}),(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("h1",{className:"text-base md:text-2xl font-bold truncate",children:"Blink Chat"}),(0,r.jsx)("p",{className:"text-xs md:text-sm opacity-90 truncate",children:a})]})]}),n&&(0,r.jsxs)("div",{className:"hidden sm:flex items-center gap-2 text-xs md:text-sm flex-shrink-0",children:[(0,r.jsx)("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),(0,r.jsx)("span",{children:"Connected"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5 md:gap-4 min-w-0 flex-shrink-0",children:[(0,r.jsx)("span",{className:"text-xs md:text-sm font-semibold text-right truncate max-w-xs",children:(null==o?void 0:o.displayName)||(null==o?void 0:null===(t=o.email)||void 0===t?void 0:t.split("@")[0])||"Guest"}),(0,r.jsx)("button",{onClick:s,className:"px-2.5 md:px-4 py-1.5 md:py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition text-xs md:text-base font-semibold flex-shrink-0",children:"Logout"})]})]})}function m(e){let{value:t,onChange:a,onSubmit:s,disabled:n,onImageSelect:l,onVideoSelect:i,onVoiceRecord:d,onNext:c,sendingMedia:u,uploadProgress:m,isWaiting:g}=e,p=(0,o.useRef)(null),x=(0,o.useRef)(null),[h,b]=(0,o.useState)(!1),f=(0,o.useRef)(null),y=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;let r=new FileReader;r.onload=()=>l({base64:r.result,name:a.name}),r.readAsDataURL(a)},w=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;let r=new FileReader;r.onload=()=>{let e=document.createElement("video");e.src=r.result,e.onloadedmetadata=()=>{let t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0),i({base64:r.result,thumbnail:t.toDataURL("image/jpeg",.7),duration:Math.ceil(e.duration),name:a.name})}},r.readAsDataURL(a)},v=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e),a=[];t.ondataavailable=e=>a.push(e.data),t.onstop=()=>{let t=new Blob(a,{type:"audio/webm"}),r=new FileReader;r.onload=()=>d({blob:t,duration:0}),r.readAsDataURL(t),e.getTracks().forEach(e=>e.stop())},f.current=t,t.start(),b(!0)}catch(e){alert("Please allow microphone access")}};return(0,r.jsxs)("div",{className:"bg-white border-t border-gray-300 p-3 md:p-4",children:[u&&m>0&&(0,r.jsx)("div",{className:"mb-2 h-1 bg-gray-300 rounded overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-blue-500",style:{width:"".concat(m,"%")}})}),g&&(0,r.jsx)("div",{className:"mb-2 text-xs md:text-sm text-gray-600 text-center",children:"\uD83D\uDCAD Waiting for stranger..."}),(0,r.jsxs)("div",{className:"flex gap-2 items-center mb-2",children:[(0,r.jsx)("input",{type:"text",value:t,onChange:a,placeholder:"Type message...",disabled:n||null!==u,className:"flex-1 border-2 border-gray-300 rounded-lg px-4 py-2 md:py-3 text-sm md:text-base focus:outline-none focus:border-blue-500"}),(0,r.jsx)("button",{onClick:s,disabled:n||!t.trim()||null!==u,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white rounded-lg p-2 md:p-3 transition flex-shrink-0 text-lg",title:"Send",children:"\uD83D\uDCE4"}),(0,r.jsx)("button",{onClick:c,disabled:n,className:"bg-orange-500 hover:bg-orange-600 disabled:bg-gray-400 text-white rounded-lg p-2 md:p-3 transition flex-shrink-0 text-lg",title:"Next",children:"➡️"})]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-center md:justify-start",children:[(0,r.jsx)("button",{onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},disabled:null!==u,className:"bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white rounded-lg p-2 md:p-3 transition flex-shrink-0 text-lg",title:"Image",children:"\uD83D\uDCF7"}),(0,r.jsx)("input",{ref:p,type:"file",accept:"image/*",onChange:y,className:"hidden"}),(0,r.jsx)("button",{onClick:()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.click()},disabled:null!==u,className:"bg-pink-500 hover:bg-pink-600 disabled:bg-gray-400 text-white rounded-lg p-2 md:p-3 transition flex-shrink-0 text-lg",title:"Video",children:"\uD83C\uDFA5"}),(0,r.jsx)("input",{ref:x,type:"file",accept:"video/*",onChange:w,className:"hidden"}),(0,r.jsx)("button",{onClick:h?()=>{f.current&&(f.current.stop(),b(!1))}:v,disabled:null!==u,className:"rounded-lg p-2 md:p-3 transition flex-shrink-0 text-lg text-white ".concat(h?"bg-red-500 hover:bg-red-600 animate-pulse":"bg-purple-500 hover:bg-purple-600 disabled:bg-gray-400"),title:"Voice",children:h?"⏹️":"\uD83C\uDFA4"})]})]})}function g(e){let{message:t,senderType:a,userName:s}=e,[n,l]=(0,o.useState)(!1);return(0,r.jsx)("div",{className:"flex gap-2 mb-2 ".concat("you"===a?"justify-end":"justify-start"," group"),children:(0,r.jsxs)("div",{className:"max-w-xs md:max-w-md ".concat("you"===a?"":"order-1"),children:["stranger"===a&&s&&(0,r.jsx)("p",{className:"text-xs font-bold text-gray-600 mb-1 px-1",children:s}),(0,r.jsxs)("div",{className:"px-4 py-2 md:py-3 rounded-2xl shadow-md animate-scalePop relative group/message ".concat("you"===a?"bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-br-none":"bg-gray-200 text-gray-900 rounded-bl-none"),children:[(0,r.jsx)("p",{className:"text-sm md:text-base break-words",children:t.text}),(0,r.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(t.text),l(!0),setTimeout(()=>l(!1),2e3)},className:"absolute -top-8 right-0 p-1 rounded opacity-0 group-hover/message:opacity-100 transition-opacity text-xs font-semibold ".concat("you"===a?"bg-purple-700 text-white":"bg-gray-300 text-gray-900"),title:"Copy message",children:n?"✅ Copied":"\uD83D\uDCCB Copy"})]})]})})}function p(e){let{message:t,senderType:a}=e,[s,n]=(0,o.useState)(!1),[l,i]=(0,o.useState)(!1),[d,c]=(0,o.useState)(!1),u=async()=>{try{c(!0),console.log("\uD83D\uDCE5 Converting and downloading...");let e=await fetch(t.mediaUrl),a=await e.blob(),r=URL.createObjectURL(a),o=document.createElement("a");o.href=r;let s="download";"video"===t.type?s="video-".concat(Date.now(),".mp4"):"image"===t.type?s="image-".concat(Date.now(),".jpg"):"voice"===t.type&&(s="voice-".concat(Date.now(),".mp3")),o.download=s,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r),console.log("✅ Downloaded:",s),c(!1)}catch(e){console.error("❌ Download error:",e),alert("Error downloading file"),c(!1)}};return"image"===t.type?(0,r.jsx)("div",{className:"flex ".concat("you"===a?"justify-end":"justify-start"," mb-2 group"),children:(0,r.jsx)("div",{className:"max-w-xs md:max-w-md relative",children:s?(0,r.jsx)("div",{className:"bg-red-100 border-2 border-red-500 rounded-xl p-4 text-center text-red-600 text-sm font-semibold",children:"❌ Image failed to load"}):(0,r.jsxs)("div",{className:"relative group/image",children:[(0,r.jsx)("img",{src:t.mediaUrl,alt:"Sent image",className:"max-w-full max-h-80 rounded-2xl shadow-md object-cover animate-scalePop",onError:()=>{console.error("❌ Image load error"),n(!0)},loading:"lazy"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover/image:bg-opacity-40 rounded-2xl transition-all flex items-center justify-center gap-2 opacity-0 group-hover/image:opacity-100",children:(0,r.jsx)("button",{onClick:u,disabled:d,className:"p-2 bg-white rounded-full hover:bg-gray-200 transition active:scale-95 disabled:opacity-60",title:"Download Image",children:d?"⏳":"\uD83D\uDCE5"})})]})})}):"video"===t.type?(0,r.jsx)("div",{className:"flex ".concat("you"===a?"justify-end":"justify-start"," mb-2"),children:(0,r.jsx)("div",{className:"max-w-xs md:max-w-md",children:s?(0,r.jsx)("div",{className:"bg-red-100 border-2 border-red-500 rounded-xl p-4 text-center text-red-600 text-sm font-semibold",children:"❌ Video failed to load"}):(0,r.jsxs)("div",{className:"relative group/video",children:[(0,r.jsx)("video",{src:t.mediaUrl,controls:!0,className:"w-full max-h-80 rounded-2xl shadow-md object-contain bg-black",poster:t.thumbnail,onError:e=>{console.error("❌ Video load error:",e),n(!0)},controlsList:"nodownload",preload:"metadata"}),t.duration&&(0,r.jsxs)("span",{className:"absolute bottom-2 right-2 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded font-semibold",children:["⏱️ ",t.duration,"s"]}),(0,r.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover/video:opacity-100 transition-opacity",children:(0,r.jsx)("button",{onClick:u,disabled:d,className:"p-2 bg-white rounded-full hover:bg-gray-200 transition active:scale-95 disabled:opacity-60 shadow-md",title:"Download Video",children:d?"⏳":"\uD83D\uDCE5"})})]})})}):"voice"===t.type?(0,r.jsx)("div",{className:"flex ".concat("you"===a?"justify-end":"justify-start"," mb-2"),children:(0,r.jsxs)("div",{className:"bg-gray-100 rounded-2xl px-4 py-3 flex items-center gap-2 shadow-md max-w-xs animate-scalePop group/voice",children:[(0,r.jsx)("button",{onClick:()=>i(!l),className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-600 text-white rounded-full flex items-center justify-center hover:shadow-md transition-all active:scale-95 flex-shrink-0",title:l?"Pause":"Play",children:l?"⏸️":"▶️"}),(0,r.jsx)("audio",{src:t.mediaUrl,controls:!0,className:"flex-1 h-8",autoPlay:l,onError:e=>{console.error("❌ Audio load error:",e),n(!0)},controlsList:"nodownload"}),t.duration&&(0,r.jsxs)("span",{className:"text-xs font-semibold text-gray-600 min-w-max",children:[t.duration,"s"]}),(0,r.jsx)("button",{onClick:u,disabled:d,className:"p-2 bg-white rounded-full hover:bg-gray-200 transition active:scale-95 disabled:opacity-60 flex-shrink-0",title:"Download Voice",children:d?"⏳":"\uD83D\uDCE5"})]})}):null}function x(e){let{strangerName:t}=e;return(0,r.jsx)("div",{className:"flex gap-2 mb-2 animate-slideIn",children:(0,r.jsxs)("div",{className:"flex items-center gap-1 px-4 py-2 bg-gray-200 text-gray-900 rounded-2xl rounded-bl-none shadow-md",children:[(0,r.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,r.jsx)("span",{className:"w-2 h-2 bg-gray-600 rounded-full animate-bounce"}),(0,r.jsx)("span",{className:"w-2 h-2 bg-gray-600 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,r.jsx)("span",{className:"w-2 h-2 bg-gray-600 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,r.jsxs)("span",{className:"text-xs font-semibold text-gray-600 ml-1",children:["typing",(0,r.jsx)("span",{className:"animate-pulse",children:"..."})]})]})})}function h(){let[e,t]=(0,o.useState)([]),[a,n]=(0,o.useState)(""),[l,i]=(0,o.useState)("Connecting..."),[d,h]=(0,o.useState)(!1),[b,f]=(0,o.useState)(!1),[y,w]=(0,o.useState)(null),[v,D]=(0,o.useState)("Stranger"),[N,j]=(0,o.useState)(null),[C,S]=(0,o.useState)(0),k=(0,o.useRef)(null),I=(0,o.useRef)(null),{user:A,logout:U}=(0,s.a)(),R=(0,o.useRef)(null),E=(0,o.useRef)(null);(0,o.useEffect)(()=>{if(!A)return;console.log("\uD83D\uDD0C Initializing Socket.IO with keepalive"),k.current=c();let e=k.current;return e.emit("user info",{userId:A.uid,email:A.email,displayName:A.displayName||A.email.split("@")[0]}),e.on("connect",()=>{console.log("✅ Socket connected"),i("Connected"),h(!0),E.current&&clearTimeout(E.current)}),e.on("connect_error",e=>{console.error("❌ Connect error:",e.message),i("⚠️ Connection error - retrying...")}),e.on("disconnect",t=>{console.log("❌ Disconnected:",t),h(!1),i("❌ Disconnected: "+t),"io server disconnect"===t&&(E.current=setTimeout(()=>{console.log("\uD83D\uDD04 Attempting to reconnect..."),e.connect()},2e3))}),e.on("waiting",e=>{i(e.message),h(!1),D("Stranger")}),e.on("paired",e=>{console.log("\uD83C\uDFAF Paired in room:",e.roomId),w(e.roomId),i("✅ Connected to a stranger"),h(!0),t([]),D("Stranger")}),e.on("chat message",e=>{var a;console.log("\uD83D\uDCAC Message received:",e.type),e.userName&&"Anonymous"!==e.userName&&D(e.userName),t(t=>[...t,{id:Date.now().toString(),text:e.message,type:e.type||"text",mediaUrl:e.mediaUrl,thumbnail:e.thumbnail,duration:e.duration,senderType:"stranger",userName:e.userName||"Stranger",timestamp:new Date}]),f(!1),null===(a=I.current)||void 0===a||a.scrollIntoView({behavior:"smooth"})}),e.on("typing",e=>{f(e.isTyping)}),e.on("stranger left",e=>{console.log("\uD83D\uDC4B Stranger left"),i("❌ "+e.message),h(!1),w(null),f(!1),D("Stranger")}),()=>{E.current&&clearTimeout(E.current),e.off("connect"),e.off("connect_error"),e.off("disconnect"),e.off("waiting"),e.off("paired"),e.off("chat message"),e.off("typing"),e.off("stranger left")}},[A]);let F=async e=>{if(e.preventDefault(),!a.trim()||!d||!k.current||!y)return;let r=a.trim();k.current.emit("chat message",{message:r,type:"text",roomId:y,userId:A.uid,userName:A.displayName||"Anonymous"}),t(e=>[...e,{id:Date.now().toString(),text:r,type:"text",senderType:"you",userName:A.displayName||"You",timestamp:new Date}]),n("")},P=async e=>{if(d&&k.current&&y){j("voice"),S(5);try{let a=new FileReader;a.onprogress=e=>{if(e.lengthComputable){let t=5+Math.round(e.loaded/e.total*85);S(t)}},a.onload=()=>{var r;S(100);let o=a.result;k.current.emit("chat message",{message:"\uD83C\uDFA4 Voice message",type:"voice",mediaUrl:o,duration:e.duration,roomId:y,userId:A.uid,userName:A.displayName||"Anonymous"},e=>{console.log("✅ Voice delivered")}),t(t=>[...t,{id:Date.now().toString(),text:"\uD83C\uDFA4 Voice message",type:"voice",mediaUrl:o,duration:e.duration,senderType:"you",userName:A.displayName||"You",timestamp:new Date}]),null===(r=I.current)||void 0===r||r.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{j(null),S(0)},500)},a.readAsDataURL(e.blob)}catch(e){console.error("❌ Voice error:",e),j(null),S(0)}}},T=async e=>{if(d&&k.current&&y){j("image"),S(5);try{var a;let r=5,o=setInterval(()=>{(r+=20*Math.random())>90&&(r=90),S(Math.floor(r))},100);k.current.emit("chat message",{message:"\uD83D\uDCF7 Image",type:"image",mediaUrl:e.base64,roomId:y,userId:A.uid,userName:A.displayName||"Anonymous"},e=>{console.log("✅ Image delivered")}),clearInterval(o),S(100),t(t=>[...t,{id:Date.now().toString(),text:"\uD83D\uDCF7 Image",type:"image",mediaUrl:e.base64,senderType:"you",userName:A.displayName||"You",timestamp:new Date}]),null===(a=I.current)||void 0===a||a.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{j(null),S(0)},500)}catch(e){console.error("❌ Image error:",e),j(null),S(0)}}},L=async e=>{if(d&&k.current&&y){console.log("\uD83C\uDFA5 SENDING VIDEO"),j("video"),S(5);try{var a;let r=5,o=Date.now(),s=setInterval(()=>{let e=Date.now()-o;(r=5+e/2e3*95)>=100&&(r=100,clearInterval(s)),S(Math.floor(r))},50);k.current.emit("chat message",{message:"\uD83C\uDFA5 Video",type:"video",mediaUrl:e.base64,thumbnail:e.thumbnail,duration:e.duration,roomId:y,userId:A.uid,userName:A.displayName||"Anonymous"},e=>{console.log("✅ Video delivered"),clearInterval(s),S(100)}),t(t=>[...t,{id:Date.now().toString(),text:"\uD83C\uDFA5 Video",type:"video",mediaUrl:e.base64,thumbnail:e.thumbnail,duration:e.duration,senderType:"you",userName:A.displayName||"You",timestamp:new Date}]),null===(a=I.current)||void 0===a||a.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{j(null),S(0)},500)}catch(e){console.error("❌ Video error:",e),alert("Error sending video: "+e.message),j(null),S(0)}}},V=async()=>{k.current&&k.current.disconnect(),await U()};return(0,r.jsxs)("div",{className:"flex flex-col h-screen bg-white",children:[(0,r.jsx)(u,{status:l,user:A,onLogout:V}),(0,r.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto scrollbar-thin p-4 md:p-5 space-y-3",children:[0===e.length?(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-center",children:(0,r.jsx)("p",{className:"text-gray-500 text-lg",children:d?"✅ Start a conversation...":"⏳ "+l})}):(0,r.jsxs)(r.Fragment,{children:[e.map(e=>"text"===e.type?(0,r.jsx)(g,{message:e,senderType:e.senderType,userName:e.userName},e.id):(0,r.jsx)(p,{message:e,senderType:e.senderType},e.id)),b&&(0,r.jsx)(x,{strangerName:v})]}),(0,r.jsx)("div",{ref:I})]}),(0,r.jsx)(m,{value:a,onChange:e=>{n(e.target.value),d&&k.current&&y&&(k.current.emit("typing",{isTyping:!0,roomId:y}),R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{k.current&&y&&k.current.emit("typing",{isTyping:!1,roomId:y})},1e3))},onSubmit:F,disabled:!d,onVoiceRecord:P,onImageSelect:T,onVideoSelect:L,onNext:()=>{k.current&&(t([]),w(null),f(!1),h(!1),i("Looking for a new stranger..."),D("Stranger"),k.current.emit("find next"))},sendingMedia:N,uploadProgress:C})]})]})}function b(){let[e,t]=(0,o.useState)(!0),{user:a,loading:i}=(0,s.a)();return i?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 to-purple-600",children:[(0,r.jsx)("div",{className:"w-16 h-16 border-4 border-white border-t-transparent rounded-full animate-spin mb-4"}),(0,r.jsx)("p",{className:"text-white text-lg font-medium",children:"Loading..."})]}):a?(0,r.jsx)(h,{}):e?(0,r.jsx)(n,{onToggleMode:()=>t(!1)}):(0,r.jsx)(l,{onToggleMode:()=>t(!0)})}},4662:function(e,t,a){"use strict";let r;a.d(t,{H:function(){return x},a:function(){return p}});var o=a(7437),s=a(2265),n=a(3085),l=a(994),i=a(4086);console.log("\uD83D\uDD25 Initializing Firebase...");let d={apiKey:"AIzaSyBoP9F82lZNJ_bIkkAWAhJwuOgYlS4JaFg",authDomain:"stranger-chat-74b46.firebaseapp.com",projectId:"stranger-chat-74b46",storageBucket:"stranger-chat-74b46.appspot.com",messagingSenderId:"75423958257",appId:"1:75423958257:web:c1cd71cd1a3c9f7f69d550"};console.log("\uD83D\uDCDD Firebase Config:",{projectId:d.projectId||"❌ MISSING",authDomain:d.authDomain||"❌ MISSING",apiKey:d.apiKey?"✅ SET":"❌ MISSING"});try{r=(0,l.ZF)(d),console.log("✅ Firebase app initialized")}catch(e){console.error("❌ Firebase initialization error:",e)}let c=(0,n.v0)(r),u=(0,i.ad)(r);(0,n.Fb)(c,n.a$).then(()=>console.log("✅ Persistence enabled")).catch(e=>console.error("❌ Persistence error:",e));let m=async(e,t)=>{if(!e)return console.warn("⚠️ No userId provided to createUserProfile"),!1;try{let a=(0,i.JU)(u,"users",e);return await (0,i.pl)(a,{...t,updatedAt:(0,i.Bt)()},{merge:!0}),console.log("✅ Profile saved for user: ".concat(e)),!0}catch(e){return console.error("❌ Error creating user profile:",e),!1}},g=(0,s.createContext)(),p=()=>{let e=(0,s.useContext)(g);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},x=e=>{let{children:t}=e,[a,r]=(0,s.useState)(null),[l,i]=(0,s.useState)(!0),[d,u]=(0,s.useState)(null);(0,s.useEffect)(()=>{console.log("\uD83D\uDD0D Setting up auth state listener...");let e=!0,t=(0,n.Aj)(c,async t=>{console.log("\uD83D\uDC64 onAuthStateChanged fired:",(null==t?void 0:t.email)||"null");try{t?(console.log("✅ User found:",t.email),m(t.uid,{uid:t.uid,email:t.email,displayName:t.displayName||t.email.split("@")[0],photoURL:t.photoURL,lastActive:new Date,status:"online"}).catch(e=>console.error("Profile update error:",e)),e&&(console.log("✅ Setting user state:",t.email),r(t),u(null),i(!1))):(console.log("❌ No user found"),e&&(r(null),i(!1)))}catch(t){console.error("❌ Auth state error:",t),e&&(u(t.message),i(!1))}},t=>{console.error("❌ Auth listener error:",t),e&&(u(t.message),i(!1))});return()=>{console.log("\uD83E\uDDF9 Cleaning up auth listener"),e=!1,t()}},[]);let p=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{i(!0),u(null),console.log("\uD83D\uDCDD Starting signup for:",e);let r=await (0,n.Xb)(c,e,t);return console.log("✅ User created in Firebase:",r.user.email),a&&(await (0,n.ck)(r.user,{displayName:a}),console.log("✅ Display name updated")),await m(r.user.uid,{uid:r.user.uid,email:r.user.email,displayName:a||e.split("@")[0],createdAt:new Date,lastActive:new Date,status:"online"}),console.log("✅ User profile created"),r}catch(e){throw console.error("❌ Signup error:",e),u("auth/email-already-in-use"===e.code?"This email is already registered":"auth/weak-password"===e.code?"Password should be at least 6 characters":e.message),i(!1),e}},x=async(e,t)=>{try{u(null),console.log("\uD83D\uDD10 Starting login for:",e);let a=await (0,n.e5)(c,e,t);return console.log("✅ User logged in:",a.user.email),m(a.user.uid,{lastActive:new Date,status:"online"}).catch(e=>console.error("Profile update error:",e)),a}catch(e){throw console.error("❌ Login error:",e),u("auth/invalid-credential"===e.code?"Invalid email or password":"auth/user-not-found"===e.code?"User not found":e.message),i(!1),e}},h=async()=>{try{u(null),i(!0);let e=new n.hJ;e.addScope("profile"),e.addScope("email"),e.setCustomParameters({prompt:"consent"}),console.log("\uD83D\uDD37 Starting Google login with popup...");let t=await (0,n.rh)(c,e);console.log("✅ Google login successful:",t.user.email),await m(t.user.uid,{uid:t.user.uid,email:t.user.email,displayName:t.user.displayName,photoURL:t.user.photoURL,provider:"google",lastActive:new Date,status:"online"}),console.log("✅ Google user profile created")}catch(e){console.error("❌ Google login error:",e.code,e.message),"auth/popup-blocked-by-browser"===e.code?u("❌ Google popup was blocked. Allow popups in browser settings."):"auth/popup-closed-by-user"===e.code?u("You closed the Google popup. Try again."):"auth/cancelled-popup-request"===e.code?u("Sign in was cancelled. Try again."):"auth/operation-not-supported-in-this-environment"===e.code?u("❌ Google sign in not available. Check Firebase config."):u(e.message||"Failed to sign in with Google"),i(!1)}},b=async e=>{try{return u(null),await (0,n.LS)(c,e),console.log("✅ Password reset email sent"),!0}catch(e){throw console.error("❌ Reset password error:",e),u("auth/user-not-found"===e.code?"No account found with this email":e.message),e}},f=async()=>{try{i(!0),u(null),console.log("\uD83D\uDEAA Logging out..."),a&&await m(a.uid,{status:"offline"}),await (0,n.w7)(c),i(!1),console.log("✅ Logout successful")}catch(e){console.error("❌ Logout error:",e),u(e.message),i(!1)}};return(0,o.jsx)(g.Provider,{value:{user:a,signup:p,login:x,googleLogin:h,resetPassword:b,logout:f,loading:l,error:d,setError:u},children:t})}}},function(e){e.O(0,[358,487,647,732,971,938,744],function(){return e(e.s=8786)}),_N_E=e.O()}]);